<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI</title>
  <meta name="description" content="R tools for biodiversity data" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://biodiversitydata-se.github.io/r-tools-tutorial/" />
  
  <meta property="og:description" content="R tools for biodiversity data" />
  <meta name="github-repo" content="biodiversitydata-se/r-tools-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI" />
  
  <meta name="twitter:description" content="R tools for biodiversity data" />
  

<meta name="author" content="Debora Arlt and Alejandro Ruete  for the Swedish Biodiversity Data Infrastructure" />


<meta name="date" content="2021-05-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon_io/favicon.ico" type="image/x-icon" />
<link rel="prev" href="example-with-fish-data-from-sers.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>R tools for biodiversity data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-and-mirroreum"><i class="fa fa-check"></i>R and Mirroreum</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sbdi4r---an-r-to-search-an-access-data"><i class="fa fa-check"></i>SBDI4R - an R 📦 to search an access data</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#customizing-sbdi4r"><i class="fa fa-check"></i>Customizing SBDI4R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-packages-needed"><i class="fa fa-check"></i>Other packages needed</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#your-collaboration-is-appreciated"><i class="fa fa-check"></i>Your collaboration is appreciated</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html"><i class="fa fa-check"></i><b>1</b> Example with fish data from SERS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#plotting-data-on-a-map"><i class="fa fa-check"></i><b>1.1</b> Plotting data on a map</a></li>
<li class="chapter" data-level="1.2" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#temporal-summary"><i class="fa fa-check"></i><b>1.2</b> Temporal summary</a></li>
<li class="chapter" data-level="1.3" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#species-summary"><i class="fa fa-check"></i><b>1.3</b> Species summary</a></li>
<li class="chapter" data-level="1.4" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#spatial-biodiversity-analysis"><i class="fa fa-check"></i><b>1.4</b> Spatial biodiversity analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html"><i class="fa fa-check"></i><b>2</b> Example with opportunistic data on Dragonflies</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#name-searching"><i class="fa fa-check"></i><b>2.1</b> Name searching</a></li>
<li class="chapter" data-level="2.2" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#filter-the-search-to-get-the-observations"><i class="fa fa-check"></i><b>2.2</b> Filter the search to get the observations</a></li>
<li class="chapter" data-level="2.3" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#quality-and-fit-for-use-check"><i class="fa fa-check"></i><b>2.3</b> Quality and fit-for-use check</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R tools for analysis <br>of primary biodiversity data provided by SBDI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-with-opportunistic-data-on-dragonflies" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Example with opportunistic data on Dragonflies</h1>
<p>In this example we are interested in exploring opportunistically collected data
from the Swedish citizen science observation data portal - Artportalen.</p>
<div id="name-searching" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Name searching</h2>
<p>To begin, we want be sure there is an unequivocal way to find the species within
the order Odonata and nothing else, so let’s search for it:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb37-1" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">search_fulltext</span>(<span class="st">&quot;odonata&quot;</span>)</span>
<span id="cb37-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb37-2" aria-hidden="true" tabindex="-1"></a>sx<span class="sc">$</span>data[, <span class="fu">c</span>(<span class="st">&quot;guid&quot;</span>, <span class="st">&quot;scientificName&quot;</span>, <span class="st">&quot;rank&quot;</span>, <span class="st">&quot;occurrenceCount&quot;</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;https://species.biodiversitydata.se/ws/search.json?q=odonata&amp;fq=idxtype%3ATAXON&quot;</code></pre>
<pre><code>##       guid                          scientificName    rank occurrenceCount
## 1  9829523  Odonata associated gemycircularvirus 1 species               0
## 2 10072832  Odonata associated gemycircularvirus 2 species               0
## 3  8062407 Bdellodes odonata Wallace &amp; Mahon, 1976 species               0
## 4      789                                 Odonata   order          207680
## 5  7367071    Ramalina fastigiata var. odonata Hue variety               0</code></pre>
<p>We quickly see there that other taxonomic definitions appear too, but there is
only one order. Let’s refine the search. To know which search fields we can use
to filter the search we use the function <code>sbdi_fields(fields_type = "general")</code>.
The search field we are looking for is “order_s.”</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb40-1" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">search_fulltext</span>(<span class="at">fq=</span><span class="st">&quot;order_s:Odonata&quot;</span>, <span class="at">page_size =</span> <span class="dv">10</span>)</span>
<span id="cb40-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb40-2" aria-hidden="true" tabindex="-1"></a>sx<span class="sc">$</span>data[, <span class="fu">c</span>(<span class="st">&quot;scientificName&quot;</span>, <span class="st">&quot;rank&quot;</span>, <span class="st">&quot;occurrenceCount&quot;</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;https://species.biodiversitydata.se/ws/search.json?fq=order_s%3AOdonata&amp;fq=idxtype%3ATAXON&amp;pageSize=10&quot;</code></pre>
<pre><code>##       guid                             scientificName  rank occurrenceCount
## 1  1429753                Gomphomacromia Brauer, 1864 genus               1
## 2  1426725               Austropetalia Tillyard, 1916 genus               0
## 3  4799335                 Sogjutella Pritykina, 1980 genus               0
## 4  4302686                    Neuragrion Karsch, 1891 genus               0
## 5  4799353              Xamenophlebia Pritykina, 1981 genus               0
## 6  1429769               Lauromacromia Geijskes, 1970 genus               0
## 7  1428195                     Sympetrum Newman, 1833 genus           27050
## 8  4798599 Corduliochlora Marinov &amp; Seidenbusch, 2007 genus               0
## 9  1423625             Torrenticnemis Lieftinck, 1949 genus               0
## 10 1423468                  Cyanallagma Kennedy, 1920 genus               0</code></pre>
<p>Now we can download the taxonomic data (note that the search is case-sensitive):</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb43-1" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> <span class="fu">taxinfo_download</span>(<span class="st">&quot;order_s:Odonata&quot;</span>, </span>
<span id="cb43-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb43-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fields =</span> <span class="fu">c</span>(<span class="st">&quot;guid&quot;</span>, <span class="st">&quot;order_s&quot;</span>,<span class="st">&quot;genus_s&quot;</span>, <span class="st">&quot;specificEpithet_s&quot;</span>, </span>
<span id="cb43-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb43-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;scientificName&quot;</span>,  <span class="st">&quot;canonicalName_s&quot;</span>, <span class="st">&quot;rank&quot;</span>), </span>
<span id="cb43-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb43-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb43-5" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> tx[tx<span class="sc">$</span>rank <span class="sc">==</span> <span class="st">&quot;species&quot;</span> <span class="sc">&amp;</span> tx<span class="sc">$</span>genusS <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,] <span class="do">## restrict to species and not hybrids</span></span></code></pre></div>
<p>Then you can save <code>tx</code> as the complete species list for later use.</p>
</div>
<div id="filter-the-search-to-get-the-observations" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Filter the search to get the observations</h2>
<p>As usual we start by searching for the data resource we are interested in using
the function <code>pick_filter()</code>. This is an interactive query guiding you through
the many resources available to filtering your query (data resources, spatial
layers, and curated species lists).</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># follow the instructions </span></span>
<span id="cb44-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb44-2" aria-hidden="true" tabindex="-1"></a>fq_str <span class="ot">&lt;-</span> <span class="fu">pick_filter</span>(<span class="st">&quot;resource&quot;</span>) </span></code></pre></div>
<p>Follow the instruction. Your choices here would have been “in3” –&gt; “dr5.”
Your variable <code>fq_str</code> will now contain a string “data_resource_uid:dr5.”</p>
<p>We only need data from 2000 to 2010</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb45-1" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb45-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb45-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb45-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb45-3" aria-hidden="true" tabindex="-1"></a>fq_str <span class="ot">&lt;-</span> <span class="fu">c</span>(fq_str, <span class="fu">paste0</span>(<span class="st">&quot;year:[&quot;</span>, y1, <span class="st">&quot; TO &quot;</span>, y2,<span class="st">&quot;]&quot;</span>))</span>
<span id="cb45-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the square brackets are hard limits</span></span></code></pre></div>
<p>We also need to filter spatially for Southern Sweden (<a href="https://en.wikipedia.org/wiki/G%C3%B6taland">Götaland</a>).</p>
<p>Vector spatial layers (eg. polygons) can be imported in a number of different ways.
SBDI APIs take as search input polygons in the s.k. WKT <a href="https://www.geoapi.org/3.0/javadoc/org/opengis/referencing/doc-files/WKT.html">Well Known Text</a>
format. So the first step is to load a vector layer and transform it into a WKT string.
You could instead use the data we kindly provided in the SBDI4R package <code>data("swe")</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;swe&quot;</span>,<span class="at">package =</span> <span class="st">&quot;SBDI4R&quot;</span>)</span>
<span id="cb46-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb46-3" aria-hidden="true" tabindex="-1"></a>wGotaland <span class="ot">&lt;-</span> swe<span class="sc">$</span>Counties<span class="sc">$</span>LnNamn <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Blekinge&quot;</span>, <span class="st">&quot;Gotlands&quot;</span>, <span class="st">&quot;Hallands&quot;</span>, </span>
<span id="cb46-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb46-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Jönköpings&quot;</span>, <span class="st">&quot;Kalmar&quot;</span>, <span class="st">&quot;Kronobergs&quot;</span>, </span>
<span id="cb46-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb46-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Östergötlands&quot;</span>, <span class="st">&quot;Skåne&quot;</span>, <span class="st">&quot;Västra Götalands&quot;</span>)</span>
<span id="cb46-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb46-6" aria-hidden="true" tabindex="-1"></a>gotaland_c <span class="ot">&lt;-</span> swe<span class="sc">$</span>Counties[wGotaland,]</span></code></pre></div>
<p>There are details about this polygon that we need to take care before. The WKT
string should not be too long to be accepted by the API service. Also, the polygon
we just got is projected in the coordinate system SWEREF99 TM, and the API service
only accepts coordinates in a geodesic coordinate system WGS84. Let’s construct
the WKT string:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform the CRS</span></span>
<span id="cb47-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-2" aria-hidden="true" tabindex="-1"></a>gotaland_c <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">as_Spatial</span>(</span>
<span id="cb47-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-3" aria-hidden="true" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(</span>
<span id="cb47-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-4" aria-hidden="true" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(gotaland_c), </span>
<span id="cb47-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)<span class="sc">$</span>wkt) )</span>
<span id="cb47-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># disolve the counties into one polygon</span></span>
<span id="cb47-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-8" aria-hidden="true" tabindex="-1"></a>gotaland <span class="ot">&lt;-</span> rgeos<span class="sc">::</span><span class="fu">gUnaryUnion</span>(gotaland_c)</span>
<span id="cb47-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the polygons coordinates</span></span>
<span id="cb47-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-11" aria-hidden="true" tabindex="-1"></a>nPol <span class="ot">&lt;-</span> <span class="fu">length</span>(gotaland<span class="sc">@</span>polygons[[<span class="dv">1</span>]]<span class="sc">@</span>Polygons) </span>
<span id="cb47-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-12" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb47-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="fu">seq</span>(nPol)){</span>
<span id="cb47-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-14" aria-hidden="true" tabindex="-1"></a>  lonlat[[p]] <span class="ot">&lt;-</span> gotaland<span class="sc">@</span>polygons[[<span class="dv">1</span>]]<span class="sc">@</span>Polygons[[p]]<span class="sc">@</span>coords</span>
<span id="cb47-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-16" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, lonlat)</span>
<span id="cb47-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co"># create a convex hull of the polygon to simplify the geometry and </span></span>
<span id="cb47-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce the length of the WKT string</span></span>
<span id="cb47-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-20" aria-hidden="true" tabindex="-1"></a>gotaland_ch <span class="ot">&lt;-</span> <span class="fu">chull</span>(lonlat)</span>
<span id="cb47-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-21" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> lonlat[<span class="fu">c</span>(gotaland_ch, gotaland_ch[<span class="dv">1</span>]), ]</span>
<span id="cb47-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># create WKT string</span></span>
<span id="cb47-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># first join each lon-lat coordinate pair</span></span>
<span id="cb47-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-25" aria-hidden="true" tabindex="-1"></a>wkt_temp <span class="ot">&lt;-</span> <span class="fu">apply</span>(lonlat, <span class="dv">1</span>, <span class="cf">function</span>(z) <span class="fu">paste</span>(<span class="fu">round</span>(z,<span class="dv">4</span>), <span class="at">collapse=</span><span class="st">&quot; &quot;</span>))</span>
<span id="cb47-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="co"># now build the WKT string</span></span>
<span id="cb47-27"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-27" aria-hidden="true" tabindex="-1"></a>wkt <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;MULTIPOLYGON(((&quot;</span>, <span class="fu">paste</span>(wkt_temp, <span class="at">collapse=</span><span class="st">&quot;,&quot;</span>), <span class="st">&quot;)))&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb47-28"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: as of today, the SBDI APIs will only work properly if the polygon is </span></span>
<span id="cb47-29"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co"># submitted as a MULTIPOLYGON</span></span></code></pre></div>
<p>The WKT string the looks like this</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb48-1" aria-hidden="true" tabindex="-1"></a>wkt</span></code></pre></div>
<pre><code>## [1] &quot;MULTIPOLYGON(((18.9004 57.4401,18.867 57.3975,18.3725 57.0068,18.3004 56.9528,16.408 56.2023,14.1906 55.3856,13.3357 55.34,12.8163 55.3859,11.2534 58.3579,11.1316 58.9094,11.1314 59.0118,11.2114 59.0897,11.3157 59.1165,11.8203 59.2355,11.9483 59.2624,12.062 59.2716,12.231 59.2736,15.7938 59.0388,15.8431 59.025,19.2889 57.9904,19.3058 57.9689,18.9004 57.4401)))&quot;</code></pre>
<p><img src="r-tools-tutorial_files/figure-html/searchpoly-1.png" width="672" /></p>
<p>Next, we download the observations using the command <code>occurrences()</code>, but be aware that
the search fields may not be the same as those use to search for taxa. We therefore
recommend using the function <code>sbdi_fields("occurrence")</code>. Here see that the field
we need this time is “order.”</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-1" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> SBDI4R<span class="sc">::</span><span class="fu">occurrences</span>(<span class="at">taxon =</span> <span class="st">&quot;order:Odonata&quot;</span>, </span>
<span id="cb50-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fq =</span> fq_str,</span>
<span id="cb50-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">wkt =</span> wkt,</span>
<span id="cb50-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extra =</span> <span class="st">&quot;collector&quot;</span>,</span>
<span id="cb50-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">email =</span> <span class="st">&quot;sbdi4r-test@biodiversitydata.se&quot;</span>, </span>
<span id="cb50-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">download_reason_id =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>We have now downloaded the data locally and depending on your configuration this
will be cached on your computer. However, as the search and download could take
long, we recommend to anyhow save the data locally.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(xf, <span class="at">file =</span> <span class="st">&quot;an_approprieted_name.rdata&quot;</span>)</span>
<span id="cb51-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;an_approprieted_name.rdata&quot;</span>)</span></code></pre></div>
</div>
<div id="quality-and-fit-for-use-check" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Quality and fit-for-use check</h2>
<p>Before we can use the observation records we need to know if the observation
effort has varied over time and in space. For this we need to define field visits
i.e. occasions at which an observer has sampled observations, and reconstruct them
(that is, assign each observation a visitUID). We do this using the package
<a href="https://greensway.github.io/BIRDS/">BIRDS</a>. We even want the data to be summarized
over a grid of 25 km (provided by the SBDI4R package). The following functions
will perform many different summaries at the same time. Please refer to the package
documentation for more detail.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BIRDS)</span>
<span id="cb52-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-2" aria-hidden="true" tabindex="-1"></a>OB <span class="ot">&lt;-</span> <span class="fu">organiseBirds</span>(xf<span class="sc">$</span>data, <span class="at">sppCol =</span> <span class="st">&quot;species&quot;</span> , </span>
<span id="cb52-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># We only want observations identified at the species level</span></span>
<span id="cb52-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxonRankCol =</span> <span class="st">&quot;rank&quot;</span>, <span class="at">taxonRank =</span> <span class="st">&quot;species&quot;</span>, </span>
<span id="cb52-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># the visits are defined by collector and named locality</span></span>
<span id="cb52-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idCols =</span> <span class="fu">c</span>(<span class="st">&quot;locality&quot;</span>, <span class="st">&quot;collector&quot;</span>), </span>
<span id="cb52-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">timeCols =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>), </span>
<span id="cb52-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xyCols =</span><span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;latitude&quot;</span>) )</span></code></pre></div>
<pre><code>## 252 observations did not match with the specified taxon rank and were removed.</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We don&#39;t need the whole grid, just the piece that overlaps our searching polygon</span></span>
<span id="cb54-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-2" aria-hidden="true" tabindex="-1"></a>gotaland_grid25 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">intersect</span>(gotaland, Sweden_Grid_25km_Wgs84)</span>
<span id="cb54-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This is another way of doing it.</span></span>
<span id="cb54-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># gotaland_grid25 &lt;- gIntersection(gotaland,</span></span>
<span id="cb54-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  spTransform(Sweden_Grid_25km_Wgs84, </span></span>
<span id="cb54-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                                              CRSobj = CRS(sf::st_crs(4326)$wkt)))</span></span>
<span id="cb54-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-9" aria-hidden="true" tabindex="-1"></a>SB <span class="ot">&lt;-</span> <span class="fu">summariseBirds</span>(OB, <span class="at">grid =</span> gotaland_grid25, <span class="at">spillOver =</span> <span class="st">&quot;unique&quot;</span>)</span></code></pre></div>
<pre><code>## 1664 observations did not overlap with the grid and will be discarded.</code></pre>
<pre><code>## 0.009 % of the visits spill over neighbouring grid cells.</code></pre>
<p>Once summarized, we can see over space and for a few selected year how was the
sampling effort (in this case number of observations) distributed.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-1" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(SB<span class="sc">$</span>spatial<span class="sc">@</span>data<span class="sc">$</span>nObs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-2" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb57-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb57-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb57-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-5" aria-hidden="true" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>()</span>
<span id="cb57-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>), <span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb57-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SB<span class="sc">$</span>spatial, <span class="at">col=</span><span class="fu">palBW</span>(SB<span class="sc">$</span>spatial<span class="sc">@</span>data<span class="sc">$</span>nObs),</span>
<span id="cb57-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">main=</span><span class="st">&quot;All years&quot;</span>) <span class="do">## with palette</span></span>
<span id="cb57-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb57-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb57-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb57-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb57-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="do">## or export other combinations, e.g. one map per observed year</span></span>
<span id="cb57-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-15" aria-hidden="true" tabindex="-1"></a>yearlySp <span class="ot">&lt;-</span> <span class="fu">exportBirds</span>(SB, </span>
<span id="cb57-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimension =</span> <span class="st">&quot;spatial&quot;</span>, </span>
<span id="cb57-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">timeRes =</span> <span class="st">&quot;yearly&quot;</span>, </span>
<span id="cb57-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable =</span> <span class="st">&quot;nObs&quot;</span>, </span>
<span id="cb57-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb57-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-21" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2005&#39;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-22" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb57-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-23" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb57-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb57-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yearlySp[<span class="st">&quot;2005&quot;</span>], <span class="at">col=</span><span class="fu">palBW</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2005&#39;</span>), </span>
<span id="cb57-27"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,<span class="at">main=</span><span class="st">&quot;2005&quot;</span>)</span>
<span id="cb57-28"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb57-29"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb57-30"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb57-31"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb57-32"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb57-33"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-34"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-34" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2010&#39;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-35"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-35" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb57-36"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-36" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb57-37"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-37" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb57-38"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-39"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yearlySp[<span class="st">&quot;2010&quot;</span>], <span class="at">col=</span><span class="fu">palBW</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2010&#39;</span>), </span>
<span id="cb57-40"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,<span class="at">main=</span><span class="st">&quot;2010&quot;</span>)</span>
<span id="cb57-41"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb57-42"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb57-43"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb57-44"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb57-45"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb57-46"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-46" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/plotBIRDSspatial-1.png" width="672" /></p>
<p>There are other ways to plot spatial data, here there is another example this time
using the package <code>sf</code> instead of <code>sp</code> and using number of visits as the measure
for sampling effort.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb58-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb58-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb58-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb58-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb58-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-7" aria-hidden="true" tabindex="-1"></a>spatial_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(SB<span class="sc">$</span>spatial)</span>
<span id="cb58-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-9" aria-hidden="true" tabindex="-1"></a>vis <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> spatial_sf, <span class="fu">aes</span>( <span class="at">fill =</span> nVis)) <span class="sc">+</span></span>
<span id="cb58-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb58-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Visits&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#56B1F7&quot;</span>,</span>
<span id="cb58-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;#132B43&quot;</span>,</span>
<span id="cb58-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb58-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb58-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb58-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-18" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> spatial_sf ,<span class="fu">aes</span>( <span class="at">fill =</span> nSpp))<span class="sc">+</span></span>
<span id="cb58-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb58-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Number of species&quot;</span>)<span class="sc">+</span></span>
<span id="cb58-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#56B1F7&quot;</span>,</span>
<span id="cb58-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;#132B43&quot;</span>,</span>
<span id="cb58-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb58-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb58-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb58-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-27"><a href="example-with-opportunistic-data-on-dragonflies.html#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(vis, spp, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/ggplot1-1.png" width="672" /></p>
<p>We see that <code>SB</code> contains an element called <code>SB$temporal</code> that contains a daily
time series with time specific rows when there is information. <code>xts</code> also supports
time, but dating below day resolution is not yet implemented in the <code>BIRDS</code> package.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb59-1" aria-hidden="true" tabindex="-1"></a>sb.xts <span class="ot">&lt;-</span> SB<span class="sc">$</span>temporal</span>
<span id="cb59-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sb.xts)</span></code></pre></div>
<pre><code>## [1] 1118    3</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sb.xts, <span class="dv">20</span>)</span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2000-03-24    1    1    1
## 2000-04-05    4    3    3
## 2000-04-06   11    6    3
## 2000-04-10    1    1    1
## 2000-04-12    3    3    1
## 2000-04-13    8    5    2
## 2000-04-20    1    1    1
## 2000-04-21    5    4    2
## 2000-04-23    5    2    3
## 2000-04-24    7    5    2
## 2000-04-26    1    1    1
## 2000-04-27    7    6    3
## 2000-04-28    9    7    3
## 2000-04-29    6    3    3
## 2000-05-27    1    1    1
## 2000-06-03    1    1    1
## 2000-07-30    1    1    1
## 2000-08-03    1    1    1
## 2000-08-05    5    2    5
## 2000-08-06    3    1    3</code></pre>
<p>Sub-setting is convenient in <code>xts</code> as you can do it with its dates and with a <code>/</code>
for a range of dates.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb63-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09-07&quot;</span>] <span class="co">#a specific day</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-07    9    7    5</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09-01/2010-09-15&quot;</span>] <span class="co">#for a period</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-01   38   15   14
## 2010-09-02   26   12   12
## 2010-09-03   20    9   10
## 2010-09-04   63   19   18
## 2010-09-05   71   25   12
## 2010-09-06   16    4    9
## 2010-09-07    9    7    5
## 2010-09-08   13    6    8
## 2010-09-09   32   12   14
## 2010-09-10    1    1    1
## 2010-09-11   15    8    8
## 2010-09-12   15    7    8
## 2010-09-13   14    5    9
## 2010-09-14    1    1    1
## 2010-09-15    3    3    2</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb67-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09&quot;</span>] <span class="co">#a specific month</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-01   38   15   14
## 2010-09-02   26   12   12
## 2010-09-03   20    9   10
## 2010-09-04   63   19   18
## 2010-09-05   71   25   12
## 2010-09-06   16    4    9
## 2010-09-07    9    7    5
## 2010-09-08   13    6    8
## 2010-09-09   32   12   14
## 2010-09-10    1    1    1
## 2010-09-11   15    8    8
## 2010-09-12   15    7    8
## 2010-09-13   14    5    9
## 2010-09-14    1    1    1
## 2010-09-15    3    3    2
## 2010-09-17    3    2    3
## 2010-09-18    9    5    5
## 2010-09-19   12    7    5
## 2010-09-21    3    2    3
## 2010-09-22    4    4    2
## 2010-09-23    3    3    2
## 2010-09-24   10    5    5
## 2010-09-25    6    3    6
## 2010-09-26    7    6    2
## 2010-09-28    2    2    2
## 2010-09-29    5    3    4
## 2010-09-30    2    2    2</code></pre>
<p>The package <code>xts</code> has several tools for converting to different periods. Here we
will use <code>to.monthly</code>. This provides, the first, min, max, and last of the data.
We can plot the daily maximum number of observations. The plot command with an
<code>xts</code> object provides a TON of features. This makes it fairly easy to customize
your plots. Read more in <code>?plot.xts</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb69-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-2" aria-hidden="true" tabindex="-1"></a>obs.m <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(sb.xts<span class="sc">$</span>nObs) </span>
<span id="cb69-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(obs.m[<span class="st">&quot;2000/2010&quot;</span>,<span class="dv">2</span>], </span>
<span id="cb69-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>, </span>
<span id="cb69-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">grid.ticks.on =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb69-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">major.ticks =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb69-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">grid.col =</span> <span class="st">&quot;lightgrey&quot;</span>,  </span>
<span id="cb69-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Maximum number of daily observations/visits per month&quot;</span>)</span>
<span id="cb69-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-10" aria-hidden="true" tabindex="-1"></a>vis.m <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(sb.xts<span class="sc">$</span>nVis) </span>
<span id="cb69-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(vis.m[<span class="st">&quot;2000/2010&quot;</span>,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: package &#39;xts&#39; was built under R version 4.0.4</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## Warning: package &#39;zoo&#39; was built under R version 4.0.4</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;xts&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:leaflet&#39;:
## 
##     addLegend</code></pre>
<p><img src="r-tools-tutorial_files/figure-html/monthlyPlot-1.png" width="864" /><img src="r-tools-tutorial_files/figure-html/monthlyPlot-2.png" width="864" /></p>
<p>We can now look at some particular species and ask whether this has changed in occurrence over time:
Plot no. records of species x and no. visits all species over years (we simply explore by comparing records for a species with no visits, can assume that species has increased of stronger positive trend than for no. visits)</p>
<p>Plot no. gridcells with visits for species x and no. gridcells with visits for all species over years (we simply explore by comparing records for a species with no visits, can assume that species has increased of stronger positive trend than for no. visits)
(species x: Tvåfläckad trollslända Epitheca bimaculata)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="example-with-fish-data-from-sers.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-tools-tutorial.pdf"],
"toc": {
"collapse": "subsection"
},
"collapse": "chapter"
});
});
</script>

</body>

</html>
