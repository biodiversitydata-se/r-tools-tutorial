<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI</title>
  <meta name="description" content="R tools for biodiversity data" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R tools for biodiversity data" />
  <meta name="github-repo" content="biodiversitydata-se/r-tools-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI" />
  
  <meta name="twitter:description" content="R tools for biodiversity data" />
  

<meta name="author" content="Debora Arlt and Alejandro Ruete  for the Swedish Biodiversity Data Infrastructure" />


<meta name="date" content="2021-05-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="example-with-fish-data-from-sers.html"/>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"> <strong>R tools for biodiversity data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-and-mirroreum"><i class="fa fa-check"></i>R and Mirroreum</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sbdi4r---r-package-to-search-an-access-data"><i class="fa fa-check"></i>SBDI4R - R package to search an access data</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#customizing-sbdi4r"><i class="fa fa-check"></i>Customizing SBDI4R</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caching"><i class="fa fa-check"></i>Caching</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#e-mail-address"><i class="fa fa-check"></i>E-mail address</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setting-the-download-reason"><i class="fa fa-check"></i>Setting the download reason</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-options"><i class="fa fa-check"></i>Other options</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-packages-needed"><i class="fa fa-check"></i>Other packages needed</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#your-collaboration-is-appreciated"><i class="fa fa-check"></i>Your collaboration is appreciated</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html"><i class="fa fa-check"></i><b>1</b> Example with fish data from SERS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#plotting-data-on-a-map"><i class="fa fa-check"></i><b>1.1</b> Plotting data on a map</a></li>
<li class="chapter" data-level="1.2" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#temporal-summary"><i class="fa fa-check"></i><b>1.2</b> Temporal summary</a></li>
<li class="chapter" data-level="1.3" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#species-summary"><i class="fa fa-check"></i><b>1.3</b> Species summary</a></li>
<li class="chapter" data-level="1.4" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#spatial-biodiversity-analysis"><i class="fa fa-check"></i><b>1.4</b> Spatial biodiversity analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html"><i class="fa fa-check"></i><b>2</b> Example with opportunistic data on Dragonflies</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#name-searching"><i class="fa fa-check"></i><b>2.1</b> Name searching</a></li>
<li class="chapter" data-level="2.2" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#get-the-observations-filter-the-search-get-quality-assertions-plotting-data-on-a-map-and-save-data"><i class="fa fa-check"></i><b>2.2</b> Get the observations, filter the search, get quality assertions, plotting data on a map and save data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R tools for analysis <br>of primary biodiversity data provided by SBDI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-with-opportunistic-data-on-dragonflies" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Example with opportunistic data on Dragonflies</h1>
<p>In this example we are interested in exploring opportunistically collected data
from the Swedish citizen science observation data portal - Artportalen.</p>
<div id="name-searching" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Name searching</h2>
<p>To begin, we want be sure there is an unequivocal way to find the species within
the order Odonata and nothing else, so let’s search for it:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SBDI4R)</span>
<span id="cb41-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb41-2" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">search_fulltext</span>(<span class="st">&quot;odonata&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;https://species.biodiversitydata.se/ws/search.json?q=odonata&amp;fq=idxtype%3ATAXON&quot;</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb43-1" aria-hidden="true" tabindex="-1"></a>sx</span></code></pre></div>
<pre><code>## Search metadata:
##   totalRecords queryTitle
## 1            5    odonata
## 
## Facet results:
## [1] &quot;NULL&quot;
## 
## Search results:
##   name                                      commonNameSingle rank     
## 1 &quot;Odonata associated gemycircularvirus 1&quot;  &quot;&quot;               &quot;species&quot;
## 2 &quot;Odonata associated gemycircularvirus 2&quot;  &quot;&quot;               &quot;species&quot;
## 3 &quot;Bdellodes odonata Wallace &amp; Mahon, 1976&quot; &quot;&quot;               &quot;species&quot;
## 4 &quot;Odonata&quot;                                 &quot;&quot;               &quot;order&quot;  
## 5 &quot;Ramalina fastigiata var. odonata Hue&quot;    &quot;&quot;               &quot;variety&quot;
##   guid      
## 1 &quot;9829523&quot; 
## 2 &quot;10072832&quot;
## 3 &quot;8062407&quot; 
## 4 &quot;789&quot;     
## 5 &quot;7367071&quot;</code></pre>
<p>we see there that other taxonomic definitions appear too, but only one order.
Let’s refine the search. To know the names of the search fields (that may not be
the same as returned column names) we can use the function <code>sbdi_fields(fields_type = "general")</code>.
The search field we are looking for is “order_s.”</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb45-1" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">search_fulltext</span>(<span class="at">fq=</span><span class="st">&quot;order_s:Odonata&quot;</span>, <span class="at">page_size =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] &quot;https://species.biodiversitydata.se/ws/search.json?fq=order_s%3AOdonata&amp;fq=idxtype%3ATAXON&amp;pageSize=10&quot;</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb47-1" aria-hidden="true" tabindex="-1"></a>sx<span class="sc">$</span>data[,<span class="fu">c</span>( <span class="st">&quot;name&quot;</span>,<span class="st">&quot;scientificName&quot;</span>, <span class="st">&quot;guid&quot;</span>, <span class="st">&quot;rank&quot;</span>)]</span></code></pre></div>
<pre><code>##                                          name
## 1                 Gomphomacromia Brauer, 1864
## 2                Austropetalia Tillyard, 1916
## 3                  Sogjutella Pritykina, 1980
## 4                     Neuragrion Karsch, 1891
## 5               Xamenophlebia Pritykina, 1981
## 6                Lauromacromia Geijskes, 1970
## 7                      Sympetrum Newman, 1833
## 8  Corduliochlora Marinov &amp; Seidenbusch, 2007
## 9              Torrenticnemis Lieftinck, 1949
## 10                  Cyanallagma Kennedy, 1920
##                                scientificName    guid  rank
## 1                 Gomphomacromia Brauer, 1864 1429753 genus
## 2                Austropetalia Tillyard, 1916 1426725 genus
## 3                  Sogjutella Pritykina, 1980 4799335 genus
## 4                     Neuragrion Karsch, 1891 4302686 genus
## 5               Xamenophlebia Pritykina, 1981 4799353 genus
## 6                Lauromacromia Geijskes, 1970 1429769 genus
## 7                      Sympetrum Newman, 1833 1428195 genus
## 8  Corduliochlora Marinov &amp; Seidenbusch, 2007 4798599 genus
## 9              Torrenticnemis Lieftinck, 1949 1423625 genus
## 10                  Cyanallagma Kennedy, 1920 1423468 genus</code></pre>
<p>Now we can download the taxonomic data (note that the search is case-sensitive):</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb49-1" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> <span class="fu">taxinfo_download</span>(<span class="st">&quot;order_s:Odonata&quot;</span>, </span>
<span id="cb49-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb49-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fields =</span> <span class="fu">c</span>(<span class="st">&quot;guid&quot;</span>, <span class="st">&quot;order_s&quot;</span>,<span class="st">&quot;genus_s&quot;</span>, <span class="st">&quot;specificEpithet_s&quot;</span>, </span>
<span id="cb49-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb49-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;scientificName&quot;</span>,  <span class="st">&quot;canonicalName_s&quot;</span>, <span class="st">&quot;rank&quot;</span>), </span>
<span id="cb49-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb49-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb49-5" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> tx[tx<span class="sc">$</span>rank <span class="sc">==</span> <span class="st">&quot;species&quot;</span> <span class="sc">&amp;</span> tx<span class="sc">$</span>genusS <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,] <span class="do">## restrict to species and not hybrids</span></span></code></pre></div>
<p>Now <code>tx</code> is our complete species list.</p>
</div>
<div id="get-the-observations-filter-the-search-get-quality-assertions-plotting-data-on-a-map-and-save-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Get the observations, filter the search, get quality assertions, plotting data on a map and save data</h2>
<p>As usual we start by searching for the data resource we are interested in using
the function <code>pick_filter()</code>. This is an interactive query guiding you through
the many resources available to filtering your query (data resources, spatial
layers, and curated species lists).</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SBDI4R)</span>
<span id="cb50-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-2" aria-hidden="true" tabindex="-1"></a>fq_str <span class="ot">&lt;-</span> <span class="fu">pick_filter</span>(<span class="st">&quot;resource&quot;</span>) </span>
<span id="cb50-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># follow the instructions </span></span></code></pre></div>
<p>Follow the instruction. Your choices here would have been “in3” –&gt; “dr5.”
Your variable <code>fq_str</code> will now contain a string “data_resource_uid:dr5.”</p>
<p>We only need data from 2000 to 2010</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb51-1" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb51-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb51-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb51-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb51-3" aria-hidden="true" tabindex="-1"></a>fq_str <span class="ot">&lt;-</span> <span class="fu">c</span>(fq_str, <span class="fu">paste0</span>(<span class="st">&quot;year:[&quot;</span>, y1, <span class="st">&quot; TO &quot;</span>, y2,<span class="st">&quot;]&quot;</span>))</span>
<span id="cb51-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the square brackets are hard limits</span></span></code></pre></div>
<p>Select data – get records for Southern Sweden (<a href="https://en.wikipedia.org/wiki/G%C3%B6taland">Götaland</a>).</p>
<p>Vector spatial layers (eg. polygons) can be imported in a number of different ways.
SBDI APIs take as search input polygons in the s.k. WKT <a href="https://www.geoapi.org/3.0/javadoc/org/opengis/referencing/doc-files/WKT.html">Well Known Text</a>
format. So the first step is to load a vector layer and transform it into a WKT string.
You could instead use the data we kindly provided in the SBDI4R package <code>data("swe")</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;swe&quot;</span>)</span>
<span id="cb52-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-2" aria-hidden="true" tabindex="-1"></a>wGotaland <span class="ot">&lt;-</span> swe<span class="sc">$</span>Counties<span class="sc">$</span>LnNamn <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Blekinge&quot;</span>, <span class="st">&quot;Gotlands&quot;</span>, <span class="st">&quot;Hallands&quot;</span>, <span class="st">&quot;Jönköpings&quot;</span>, <span class="st">&quot;Kalmar&quot;</span>, <span class="st">&quot;Kronobergs&quot;</span>, <span class="st">&quot;Östergötlands&quot;</span>, <span class="st">&quot;Skåne&quot;</span>, <span class="st">&quot;Västra Götalands&quot;</span>)</span>
<span id="cb52-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb52-3" aria-hidden="true" tabindex="-1"></a>gotaland_c <span class="ot">&lt;-</span> swe<span class="sc">$</span>Counties[wGotaland,]</span></code></pre></div>
<p>We could create the WKT string using the <code>rgeos</code> library:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span>
<span id="cb53-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb53-2" aria-hidden="true" tabindex="-1"></a>wkt <span class="ot">&lt;-</span> <span class="fu">writeWKT</span>(gotaland_c)</span></code></pre></div>
<p>Unfortunately, in this instance this gives a WKT string that is too long and won’t
be accepted by the web service. Also, the shapefile we just got is projected in
the coordinate system SWEREF99 TM, and the web service only accepts coordinates in
a geodesic coordinate system WGS84. Instead, let’s construct the WKT string directly,
which gives us a little more control over its format:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-1" aria-hidden="true" tabindex="-1"></a>gotaland_c <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">as_Spatial</span>(</span>
<span id="cb54-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-2" aria-hidden="true" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(</span>
<span id="cb54-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-3" aria-hidden="true" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(gotaland_c), </span>
<span id="cb54-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)<span class="sc">$</span>wkt) )</span>
<span id="cb54-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-6" aria-hidden="true" tabindex="-1"></a>gotaland <span class="ot">&lt;-</span> rgeos<span class="sc">::</span><span class="fu">gUnaryUnion</span>(gotaland_c)</span>
<span id="cb54-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the polygons coordinates</span></span>
<span id="cb54-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-9" aria-hidden="true" tabindex="-1"></a>nPol <span class="ot">&lt;-</span> <span class="fu">length</span>(gotaland<span class="sc">@</span>polygons[[<span class="dv">1</span>]]<span class="sc">@</span>Polygons) </span>
<span id="cb54-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-10" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb54-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="fu">seq</span>(nPol)){</span>
<span id="cb54-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-12" aria-hidden="true" tabindex="-1"></a>  lonlat[[p]] <span class="ot">&lt;-</span> gotaland<span class="sc">@</span>polygons[[<span class="dv">1</span>]]<span class="sc">@</span>Polygons[[p]]<span class="sc">@</span>coords</span>
<span id="cb54-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-14" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, lonlat)</span>
<span id="cb54-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create a convex hull of the polygon to reduce the length of the WKT string</span></span>
<span id="cb54-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-17" aria-hidden="true" tabindex="-1"></a>gotaland_ch <span class="ot">&lt;-</span> <span class="fu">chull</span>(lonlat)</span>
<span id="cb54-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-18" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> lonlat[<span class="fu">c</span>(gotaland_ch, gotaland_ch[<span class="dv">1</span>]), ]</span>
<span id="cb54-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create WKT string</span></span>
<span id="cb54-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co"># first join each lon-lat coordinate pair</span></span>
<span id="cb54-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-22" aria-hidden="true" tabindex="-1"></a>wkt_temp <span class="ot">&lt;-</span> <span class="fu">apply</span>(lonlat, <span class="dv">1</span>, <span class="cf">function</span>(z) <span class="fu">paste</span>(<span class="fu">round</span>(z,<span class="dv">4</span>), <span class="at">collapse=</span><span class="st">&quot; &quot;</span>))</span>
<span id="cb54-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="co"># now build the WKT string</span></span>
<span id="cb54-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-24" aria-hidden="true" tabindex="-1"></a>wkt <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;MULTIPOLYGON(((&quot;</span>, <span class="fu">paste</span>(wkt_temp, <span class="at">collapse=</span><span class="st">&quot;,&quot;</span>), <span class="st">&quot;)))&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb54-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: as of today, the SBDI APIs will only work properly if the polygon is </span></span>
<span id="cb54-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="co"># submitted as a MULTIPOLYGON</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sbdi_fields</span>(<span class="st">&quot;occurrence&quot;</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##                              name dataType
## 1   abcd_identification_qualifier   string
## 2                   access_rights   string
## 3                      assertions   string
## 4              assertions_missing   string
## 5               assertions_passed   string
## 6            assertions_unchecked   string
## 7                 basis_of_record   string
## 8                        behavior   string
## 9          bibliographic_citation   string
## 10               catalogue_number   string
## 11                        cl10038   string
## 12                        cl10040   string
## 13                        cl10041   string
## 14                        cl10042   string
## 15                        cl10046   string
## 16                        cl10047   string
## 17                        cl10048   string
## 18                        cl10050   string
## 19                        cl10051   string
## 20                        cl10052   string
## 21                        cl10053   string
## 22                        cl10054   string
## 23                        cl10055   string
## 24                        cl10057   string
## 25                        cl10058   string
## 26                        cl10059   string
## 27                        cl10061   string
## 28                        cl10063   string
## 29                        cl10064   string
## 30                        cl10065   string
## 31                        cl10066   string
## 32                        cl10067   string
## 33                        cl10068   string
## 34                        cl10070   string
## 35                        cl10071   string
## 36                        cl10073   string
## 37                        cl10074   string
## 38                        cl10082   string
## 39                        cl10083   string
## 40                        cl10084   string
## 41                        cl10087   string
## 42                        cl10089   string
## 43                        cl10090   string
## 44                        cl10097   string
## 45                        cl10101   string
## 46                        cl10102   string
## 47                        cl10104   string
## 48                          class   string
## 49                       class_id   string
## 50                collection_code   string
## 51                  collection_id   string
## 52                collection_name   string
## 53                 collection_uid   string
## 54                      collector   string
## 55                    common_name   string
## 56           common_name_and_lsid   string
## 57         coordinate_uncertainty  tdouble
## 58                        country   string
## 59                   country_code   string
## 60                         county   string
## 61                  data_provider   string
## 62              data_provider_uid   string
## 63                  data_resource   string
## 64              data_resource_uid   string
## 65                     dataset_id   string
## 66                   dataset_name   string
## 67                 date_precision   string
## 68                          datum   string
## 69                            day   string
## 70                    disposition   string
## 71             dynamic_properties   string
## 72                        el10000   tfloat
## 73                        el10001   tfloat
## 74                        el10002   tfloat
## 75                        el10003   tfloat
## 76                        el10004   tfloat
## 77                        el10005   tfloat
## 78                        el10006   tfloat
## 79                        el10007   tfloat
## 80                        el10008   tfloat
## 81                        el10009   tfloat
## 82                        el10010   tfloat
## 83                        el10011   tfloat
## 84                        el10012   tfloat
## 85                        el10013   tfloat
## 86                        el10014   tfloat
## 87                        el10015   tfloat
## 88                        el10016   tfloat
## 89                        el10017   tfloat
## 90                        el10018   tfloat
## 91                        el10019   tfloat
## 92                        el10020   tfloat
## 93                        el10021   tfloat
## 94                        el10022   tfloat
## 95                        el10023   tfloat
## 96                        el10024   tfloat
## 97                        el10025   tfloat
## 98                        el10026   tfloat
## 99                        el10027   tfloat
## 100                       el10028   tfloat
## 101                       el10029   tfloat
## 102                       el10030   tfloat
## 103                       el10031   tfloat
## 104                       el10032   tfloat
## 105                       el10033   tfloat
## 106                       el10034   tfloat
## 107                       el10035   tfloat
## 108                       el10036   tfloat
## 109                       el10044   tfloat
## 110                     elevation   double
## 111               end_day_of_year   string
## 112           establishment_means   string
## 113                      event_id   string
## 114                 event_remarks   string
## 115                    event_time   string
## 116                        family   string
## 117                     family_id   string
## 118                  field_number   string
## 119             first_loaded_date    tdate
## 120                         genus   string
## 121                    genus_guid   string
## 122          georeference_remarks   string
## 123              georeferenced_by   string
## 124            georeferenced_date   string
## 125             geospatial_kosher   string
## 126                       habitat   string
## 127         higher_classification   string
## 128              higher_geography   string
## 129                            id   string
## 130      identification_qualifier   string
## 131        identification_remarks   string
## 132                 identified_by   string
## 133               identified_date    tdate
## 134              individual_count   string
## 135         infraspecific_epithet   string
## 136              institution_code   string
## 137              institution_name   string
## 138               institution_uid   string
## 139                        island   string
## 140                  island_group   string
## 141                       kingdom   string
## 142                    kingdom_id   string
## 143                      language   string
## 144                last_load_date    tdate
## 145           last_processed_date    tdate
## 146                      lat_long   string
## 147                      latitude  tdouble
## 149                       license   string
## 150         location_according_to   string
## 151                   location_id   string
## 152              location_remarks   string
## 153                     longitude  tdouble
## 154                      mappable   string
## 155                   max_depth_d  tdouble
## 156               max_elevation_d  tdouble
## 157                   min_depth_d  tdouble
## 158               min_elevation_d  tdouble
## 159           min_elevation_d_rng  tdouble
## 160                 modified_date    tdate
## 161                         month   string
## 162                    multimedia   string
## 163                  municipality   string
## 164             name_match_metric   string
## 165               name_parse_type   string
## 166                names_and_lsid   string
## 167               occurrence_date    tdate
## 168        occurrence_date_end_dt    tdate
## 169           occurrence_decade_i     tint
## 170                 occurrence_id   string
## 171            occurrence_remarks   string
## 172             occurrence_status   string
## 173               occurrence_year    tdate
## 174                         order   string
## 175                      order_id   string
## 176             organism_quantity   string
## 177        organism_quantity_type   string
## 178           original_name_usage   string
## 179         other_catalog_numbers   string
## 180           outlier_layer_count     tint
## 181        owner_institution_code   string
## 182                        phylum   string
## 183                     phylum_id   string
## 184                  point-0.0001   string
## 185                   point-0.001   string
## 186                    point-0.01   string
## 187                    point-0.02   string
## 188                     point-0.1   string
## 189                       point-1   string
## 190                  preparations   string
## 191      previous_identifications   string
## 192                    provenance   string
## 193                          rank   string
## 194                       rank_id     tint
## 195     raw_associated_references   string
## 196           raw_basis_of_record   string
## 197                     raw_class   string
## 198               raw_common_name   string
## 199                 raw_continent   string
## 200      raw_coordinate_precision   string
## 201    raw_coordinate_uncertainty   string
## 202                   raw_country   string
## 203                     raw_datum   string
## 204                       raw_day   string
## 205       raw_establishment_means   string
## 206                    raw_family   string
## 207                     raw_genus   string
## 208      raw_georeference_remarks   string
## 209          raw_georeferenced_by   string
## 210        raw_georeferenced_date   string
## 211                   raw_habitat   string
## 212  raw_identification_qualifier   string
## 213           raw_identified_date   string
## 214      raw_information_withheld   string
## 215            raw_institution_id   string
## 216                   raw_kingdom   string
## 217                  raw_latitude   string
## 218                   raw_license   string
## 219                raw_life_stage   string
## 220                  raw_locality   string
## 221                 raw_longitude   string
## 222                 raw_max_depth   string
## 223             raw_max_elevation   string
## 224                 raw_min_depth   string
## 225             raw_min_elevation   string
## 226             raw_modified_date   string
## 227                     raw_month   string
## 228                      raw_name  textgen
## 229        raw_nomenclatural_code   string
## 230           raw_occurrence_date   string
## 231         raw_occurrence_status   string
## 232           raw_occurrence_year   string
## 233                     raw_order   string
## 234                    raw_phylum   string
## 235                      raw_rank   string
## 236         raw_sampling_protocol   string
## 237                       raw_sex   string
## 238                     raw_state   string
## 239                raw_taxon_name   string
## 240               raw_type_status   string
## 241            raw_verbatim_depth   string
## 242        raw_verbatim_elevation   string
## 243                 record_number   string
## 245                  rightsholder   string
## 246               sampling_effort   string
## 247    scientific_name_authorship   string
## 248            scientific_name_id   string
## 249                     sensitive   string
## 250                       species   string
## 251                 species_group   string
## 252                  species_guid   string
## 253              species_subgroup   string
## 254              specific_epithet   string
## 255             start_day_of_year   string
## 256                         state   string
## 257                      subgenus   string
## 258                    subspecies   string
## 259               subspecies_guid   string
## 260                 subspecies_id   string
## 261               subspecies_name   string
## 262            suitable_modelling   string
## 263             system_assertions   string
## 264            taxon_concept_lsid   string
## 265                      taxon_id   string
## 266                    taxon_name   string
## 267                 taxon_remarks   string
## 268               taxonomic_issue   string
## 269              taxonomic_kosher   string
## 270                   type_status   string
## 271    verbatim_coordinate_system   string
## 272          verbatim_coordinates   string
## 273           verbatim_event_date   string
## 274             verbatim_latitude   string
## 275             verbatim_locality   string
## 276            verbatim_longitude   string
## 277                  verbatim_srs   string
## 278           verbatim_taxon_rank   string
## 279                    water_body   string
## 280                          year      int</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-1" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> SBDI4R<span class="sc">::</span><span class="fu">occurrences</span>(<span class="at">taxon =</span> <span class="st">&quot;order:Odonata&quot;</span>, </span>
<span id="cb57-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fq =</span> fq_str,</span>
<span id="cb57-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">wkt =</span> wkt,</span>
<span id="cb57-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extra =</span> <span class="st">&quot;collector&quot;</span>,</span>
<span id="cb57-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">email =</span> <span class="st">&quot;sbdi4r-test@biodiversitydata.se&quot;</span>, </span>
<span id="cb57-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">download_reason_id =</span> <span class="dv">10</span>)</span>
<span id="cb57-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb57-8" aria-hidden="true" tabindex="-1"></a>xf<span class="sc">$</span>meta</span></code></pre></div>
<pre><code>##   UID                                                 Name
## 1 dp0                                      IPT GBIF Sweden
## 2 co3 Artportalen - The Swedish Species Observation System
## 3 dr5     Artportalen (Swedish Species Observation System)
## 4 in3      The Swedish University of Agricultural Sciences
##                       DOI
## 1                        
## 2                        
## 3 doi.org/10.15468/kllkyl
## 4                        
##                                                                                                                         Citation
## 1                                                             Records provided by IPT GBIF Sweden, accessed through ALA website.
## 2                        Records provided by Artportalen - The Swedish Species Observation System, accessed through ALA website.
## 3 Artportalen (Swedish Species Observation System). ArtDatabanken. Dataset/Occurrence. http://www.gbif.se/ipt/resource?r=artdata
## 4                             Records provided by The Swedish University of Agricultural Sciences, accessed through ALA website.
##                                                                                                                                                                                                                                                                        Rights
## 1                                                                                                                                                                                                                                                                            
## 2                                                                                                                                                                                                                                                                            
## 3 Public Domain (CC0) To the extent possible under law, the publisher has waived all rights to these data and has dedicated them to the Public Domain (CC0 1.0). Users may copy, modify, distribute and use the work, including for commercial purposes, without restriction.
## 4                                                                                                                                                                                                                                                                            
##                                                                More.Information
## 1 For more information: https://collections.biodiversitydata.se/public/show/dp0
## 2 For more information: https://collections.biodiversitydata.se/public/show/co3
## 3 For more information: https://collections.biodiversitydata.se/public/show/dr5
## 4 For more information: https://collections.biodiversitydata.se/public/show/in3
##   Data.generalisations Information.withheld Download.limit
## 1                   NA                   NA             NA
## 2                   NA                   NA             NA
## 3                   NA                   NA             NA
## 4                   NA                   NA             NA
##   Number.of.Records.in.Download
## 1                         27290
## 2                         26744
## 3                         31779
## 4                         26744</code></pre>
<p>but before we can use the observation records we need to know how the observation effort has varied over time and in space. For this we define field visits i.e. occasions at which an observer has sampled observations – if we have information on observer id, location id and date we can aggregate data into “field visits.” We do this using BIRDS, and 25km grid:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BIRDS)</span></code></pre></div>
<pre><code>## Warning: package &#39;BIRDS&#39; was built under R version 4.0.5</code></pre>
<pre><code>## 
## Attaching package: &#39;BIRDS&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     gotaland</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb63-1" aria-hidden="true" tabindex="-1"></a>OB <span class="ot">&lt;-</span> <span class="fu">organiseBirds</span>(xf<span class="sc">$</span>data, <span class="at">sppCol =</span> <span class="st">&quot;species&quot;</span> , </span>
<span id="cb63-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb63-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxonRankCol =</span> <span class="st">&quot;rank&quot;</span>, <span class="at">taxonRank =</span> <span class="st">&quot;species&quot;</span>, </span>
<span id="cb63-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb63-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idCols =</span> <span class="fu">c</span>(<span class="st">&quot;locality&quot;</span>, <span class="st">&quot;collector&quot;</span>), </span>
<span id="cb63-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb63-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">timeCols =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>), </span>
<span id="cb63-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb63-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xyCols =</span><span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;latitude&quot;</span>) )</span></code></pre></div>
<pre><code>## 252 observations did not match with the specified taxon rank and were removed.</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-1" aria-hidden="true" tabindex="-1"></a>gotaland_grid25 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">intersect</span>(gotaland, Sweden_Grid_25km_Wgs84)</span>
<span id="cb65-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># gotaland_grid25 &lt;- gIntersection(spTransform(Sweden_Grid_25km_Wgs84, </span></span>
<span id="cb65-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                                              CRSobj = CRS(sf::st_crs(4326)$wkt)),</span></span>
<span id="cb65-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  gotaland,</span></span>
<span id="cb65-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  byid = TRUE)</span></span>
<span id="cb65-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb65-8" aria-hidden="true" tabindex="-1"></a>SB <span class="ot">&lt;-</span> <span class="fu">summariseBirds</span>(OB, <span class="at">grid =</span> gotaland_grid25, <span class="at">spillOver =</span> <span class="st">&quot;unique&quot;</span>)</span></code></pre></div>
<pre><code>## 1664 observations did not overlap with the grid and will be discarded.</code></pre>
<pre><code>## 0.009 % of the visits spill over neighbouring grid cells.</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-1" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(SB<span class="sc">$</span>spatial<span class="sc">@</span>data<span class="sc">$</span>nObs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-2" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb68-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb68-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb68-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-5" aria-hidden="true" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>()</span>
<span id="cb68-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>), <span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb68-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SB<span class="sc">$</span>spatial, <span class="at">col=</span><span class="fu">palBW</span>(SB<span class="sc">$</span>spatial<span class="sc">@</span>data<span class="sc">$</span>nObs),</span>
<span id="cb68-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">main=</span><span class="st">&quot;All years&quot;</span>) <span class="do">## with palette</span></span>
<span id="cb68-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb68-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb68-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb68-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb68-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="do">## or export other combinations, e.g. one map per observed year</span></span>
<span id="cb68-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-15" aria-hidden="true" tabindex="-1"></a>yearlySp <span class="ot">&lt;-</span> <span class="fu">exportBirds</span>(SB, </span>
<span id="cb68-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimension =</span> <span class="st">&quot;spatial&quot;</span>, </span>
<span id="cb68-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">timeRes =</span> <span class="st">&quot;yearly&quot;</span>, </span>
<span id="cb68-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable =</span> <span class="st">&quot;nObs&quot;</span>, </span>
<span id="cb68-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb68-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-21" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2005&#39;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-22" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb68-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-23" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb68-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb68-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yearlySp[<span class="st">&quot;2005&quot;</span>], <span class="at">col=</span><span class="fu">palBW</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2005&#39;</span>), </span>
<span id="cb68-27"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,<span class="at">main=</span><span class="st">&quot;2005&quot;</span>)</span>
<span id="cb68-28"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb68-29"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb68-30"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb68-31"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb68-32"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb68-33"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-34"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-34" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2010&#39;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-35"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-35" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb68-36"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-36" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb68-37"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-37" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb68-38"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-39"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yearlySp[<span class="st">&quot;2010&quot;</span>], <span class="at">col=</span><span class="fu">palBW</span>(yearlySp<span class="sc">@</span>data<span class="sc">$</span><span class="st">&#39;2010&#39;</span>), </span>
<span id="cb68-40"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,<span class="at">main=</span><span class="st">&quot;2010&quot;</span>)</span>
<span id="cb68-41"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-41" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb68-42"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb68-43"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb68-44"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb68-45"><a href="example-with-opportunistic-data-on-dragonflies.html#cb68-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/plotBIRDSspatial-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">par</span>(oldpar))</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<pre><code>## Warning: package &#39;sf&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code></pre></div>
<pre><code>## Warning: package &#39;cowplot&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb75-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span></code></pre></div>
<pre><code>## Warning: package &#39;colorRamps&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-1" aria-hidden="true" tabindex="-1"></a>spatial_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(SB<span class="sc">$</span>spatial)</span>
<span id="cb77-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-3" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> spatial_sf, <span class="fu">aes</span>( <span class="at">fill =</span> nVis))<span class="sc">+</span></span>
<span id="cb77-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb77-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Visits&quot;</span>)<span class="sc">+</span></span>
<span id="cb77-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#56B1F7&quot;</span>,</span>
<span id="cb77-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;#132B43&quot;</span>,</span>
<span id="cb77-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb77-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-11" aria-hidden="true" tabindex="-1"></a>obs</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/ggplot1-1.png" width="480" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-1" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> spatial_sf ,<span class="fu">aes</span>( <span class="at">fill =</span> nSpp))<span class="sc">+</span></span>
<span id="cb78-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb78-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Number of species&quot;</span>)<span class="sc">+</span></span>
<span id="cb78-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#56B1F7&quot;</span>,</span>
<span id="cb78-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;#132B43&quot;</span>,</span>
<span id="cb78-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb78-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb78-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-9" aria-hidden="true" tabindex="-1"></a>spp</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/ggplot2-1.png" width="480" /></p>
<p>How has observation effort (frequency of visits) varied over time and space? – 1) show maps as in Example 7 (all years, year 2000, 2002, 2004, 2006, 2008, 2010), 2 make also a time line plot with no. visits against years, no. of gridcells with visits against years.</p>
<p>we see that SB contains an element called <code>SB$temporal</code> that contains a daily time series with time specific rows when there is information. <code>xts</code> also supports time, but dating below day resolution is not yet implemented in the <code>BIRDS</code> package.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-1" aria-hidden="true" tabindex="-1"></a>sb.xts <span class="ot">&lt;-</span> SB<span class="sc">$</span>temporal</span>
<span id="cb79-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sb.xts)</span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2000-03-24    1    1    1
## 2000-04-05    4    3    3
## 2000-04-06   11    6    3
## 2000-04-10    1    1    1
## 2000-04-12    3    3    1
## 2000-04-13    8    5    2</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sb.xts)</span></code></pre></div>
<pre><code>## [1] 1118    3</code></pre>
<p>Sub-setting is convenient in <code>xts</code> as you can do it with its dates and with a <code>/</code> for a range of dates.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb83-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09&quot;</span>] <span class="co">#a specific month</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-01   38   15   14
## 2010-09-02   26   12   12
## 2010-09-03   20    9   10
## 2010-09-04   63   19   18
## 2010-09-05   71   25   12
## 2010-09-06   16    4    9
## 2010-09-07    9    7    5
## 2010-09-08   13    6    8
## 2010-09-09   32   12   14
## 2010-09-10    1    1    1
## 2010-09-11   15    8    8
## 2010-09-12   15    7    8
## 2010-09-13   14    5    9
## 2010-09-14    1    1    1
## 2010-09-15    3    3    2
## 2010-09-17    3    2    3
## 2010-09-18    9    5    5
## 2010-09-19   12    7    5
## 2010-09-21    3    2    3
## 2010-09-22    4    4    2
## 2010-09-23    3    3    2
## 2010-09-24   10    5    5
## 2010-09-25    6    3    6
## 2010-09-26    7    6    2
## 2010-09-28    2    2    2
## 2010-09-29    5    3    4
## 2010-09-30    2    2    2</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb85-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09-07&quot;</span>] <span class="co">#a specific day</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-07    9    7    5</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2007-01-01/2007-05-01&quot;</span>] <span class="co">#for a period</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2007-03-05    1    1    1
## 2007-03-14    1    1    1
## 2007-03-20    4    4    4
## 2007-04-02    7    4    4
## 2007-04-11   14    7    3
## 2007-04-12    8    6    4
## 2007-04-13    1    1    1
## 2007-04-15    1    1    1
## 2007-04-17    6    4    3
## 2007-04-18    1    1    1
## 2007-04-21    1    1    1
## 2007-04-23    1    1    1
## 2007-04-27   11    6    4
## 2007-04-28    4    4    3
## 2007-04-30    2    2    2</code></pre>
<p>The package <code>xts</code> has several tools for converting to different periods. Here we will use <code>to.monthly</code>. This provides, the first, min, max, and last of the data. We can plot the daily maximum number of observations. The plot command with an <code>xts</code> object provides a TON of features. This makes it fairly easy to customize your plots. Read more in <code>?plot.xts</code>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb89-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb89-2" aria-hidden="true" tabindex="-1"></a>obs.m <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(sb.xts<span class="sc">$</span>nObs) </span>
<span id="cb89-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb89-3" aria-hidden="true" tabindex="-1"></a>obs.m[<span class="st">&quot;2007-04&quot;</span>]</span></code></pre></div>
<pre><code>##          sb.xts$nObs.Open sb.xts$nObs.High sb.xts$nObs.Low sb.xts$nObs.Close
## Apr 2007                7               14               1                 2</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb91-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2007-04&quot;</span>]</span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2007-04-02    7    4    4
## 2007-04-11   14    7    3
## 2007-04-12    8    6    4
## 2007-04-13    1    1    1
## 2007-04-15    1    1    1
## 2007-04-17    6    4    3
## 2007-04-18    1    1    1
## 2007-04-21    1    1    1
## 2007-04-23    1    1    1
## 2007-04-27   11    6    4
## 2007-04-28    4    4    3
## 2007-04-30    2    2    2</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(obs.m[<span class="st">&quot;2000/2010&quot;</span>,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">grid.ticks.on =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb93-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb93-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">major.ticks =</span> <span class="st">&quot;month&quot;</span>, <span class="at">grid.col =</span> <span class="st">&quot;lightgrey&quot;</span>,  </span>
<span id="cb93-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb93-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Maximum number of daily observations per month&quot;</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/monthly%20and%20plot-1.png" width="864" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb94-1" aria-hidden="true" tabindex="-1"></a>vis.m <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(sb.xts<span class="sc">$</span>nVis) </span>
<span id="cb94-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb94-2" aria-hidden="true" tabindex="-1"></a>vis.m[<span class="st">&quot;2007-04&quot;</span>]</span></code></pre></div>
<pre><code>##          sb.xts$nVis.Open sb.xts$nVis.High sb.xts$nVis.Low sb.xts$nVis.Close
## Apr 2007                4                7               1                 2</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb96-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2007-04&quot;</span>]</span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2007-04-02    7    4    4
## 2007-04-11   14    7    3
## 2007-04-12    8    6    4
## 2007-04-13    1    1    1
## 2007-04-15    1    1    1
## 2007-04-17    6    4    3
## 2007-04-18    1    1    1
## 2007-04-21    1    1    1
## 2007-04-23    1    1    1
## 2007-04-27   11    6    4
## 2007-04-28    4    4    3
## 2007-04-30    2    2    2</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vis.m[<span class="st">&quot;2000/2010&quot;</span>,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">grid.ticks.on =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb98-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb98-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">major.ticks =</span> <span class="st">&quot;month&quot;</span>, <span class="at">grid.col =</span> <span class="st">&quot;lightgrey&quot;</span>, </span>
<span id="cb98-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb98-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Maximum number of daily visits per month&quot;</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/monthly%20and%20plot-2.png" width="864" /></p>
<p>We can now look at some particular species and ask whether this has changed in occurrence over time:
Plot no. records of species x and no. visits all species over years (we simply explore by comparing records for a species with no visits, can assume that species has increased of stronger positive trend than for no. visits)</p>
<p>Plot no. gridcells with visits for species x and no. gridcells with visits for all species over years (we simply explore by comparing records for a species with no visits, can assume that species has increased of stronger positive trend than for no. visits)
(species x: Tvåfläckad trollslända Epitheca bimaculata)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="example-with-fish-data-from-sers.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-tools-tutorial.pdf"],
"toc": {
"collapse": "subsection"
},
"collapse": "chapter"
});
});
</script>

</body>

</html>
