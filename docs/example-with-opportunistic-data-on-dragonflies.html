<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI</title>
  <meta name="description" content="R tools for biodiversity data" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://biodiversitydata-se.github.io/r-tools-tutorial/" />
  
  <meta property="og:description" content="R tools for biodiversity data" />
  <meta name="github-repo" content="biodiversitydata-se/r-tools-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Example with opportunistic data on Dragonflies | Using R tools for analysis  of primary biodiversity data provided by SBDI" />
  
  <meta name="twitter:description" content="R tools for biodiversity data" />
  

<meta name="author" content="Debora Arlt and Alejandro Ruete  for the Swedish Biodiversity Data Infrastructure" />


<meta name="date" content="2021-10-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon_io/favicon.ico" type="image/x-icon" />
<link rel="prev" href="example-with-fish-data-from-sers.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>R tools for biodiversity data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-and-mirroreum"><i class="fa fa-check"></i>R and Mirroreum</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sbdi4r---an-r-to-search-an-access-data"><i class="fa fa-check"></i>SBDI4R - an R üì¶ to search an access data</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-packages-needed"><i class="fa fa-check"></i>Other packages needed</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#your-collaboration-is-appreciated"><i class="fa fa-check"></i>Your collaboration is appreciated</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html"><i class="fa fa-check"></i><b>1</b> Example with fish data from SERS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#plotting-data-on-a-map"><i class="fa fa-check"></i><b>1.1</b> Plotting data on a map</a></li>
<li class="chapter" data-level="1.2" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#temporal-summary"><i class="fa fa-check"></i><b>1.2</b> Temporal summary</a></li>
<li class="chapter" data-level="1.3" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#species-summary"><i class="fa fa-check"></i><b>1.3</b> Species summary</a></li>
<li class="chapter" data-level="1.4" data-path="example-with-fish-data-from-sers.html"><a href="example-with-fish-data-from-sers.html#spatial-biodiversity-analysis"><i class="fa fa-check"></i><b>1.4</b> Spatial biodiversity analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html"><i class="fa fa-check"></i><b>2</b> Example with opportunistic data on Dragonflies</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#name-searching"><i class="fa fa-check"></i><b>2.1</b> Name searching</a></li>
<li class="chapter" data-level="2.2" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#filter-the-search-to-get-the-observations"><i class="fa fa-check"></i><b>2.2</b> Filter the search to get the observations</a></li>
<li class="chapter" data-level="2.3" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#quality-and-fit-for-use-check"><i class="fa fa-check"></i><b>2.3</b> Quality and fit-for-use check</a></li>
<li class="chapter" data-level="2.4" data-path="example-with-opportunistic-data-on-dragonflies.html"><a href="example-with-opportunistic-data-on-dragonflies.html#species-trends"><i class="fa fa-check"></i><b>2.4</b> Species trends</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R tools for analysis <br>of primary biodiversity data provided by SBDI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-with-opportunistic-data-on-dragonflies" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Example with opportunistic data on Dragonflies</h1>
<p>In this example we are interested in exploring opportunistically
collected data from the Swedish citizen science species observation
portal - Artportalen.</p>
<div id="name-searching" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Name searching</h2>
<p>To begin with, we want be sure there is an unequivocal way to find the
species within the order Odonata (dragonflies) and nothing else, so
let‚Äôs search for ‚Äúodonata‚Äù:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-1" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">search_fulltext</span>(<span class="st">&quot;odonata&quot;</span>)</span>
<span id="cb69-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb69-2" aria-hidden="true" tabindex="-1"></a>sx<span class="sc">$</span>data[, <span class="fu">c</span>(<span class="st">&quot;guid&quot;</span>, <span class="st">&quot;scientificName&quot;</span>, <span class="st">&quot;rank&quot;</span>, <span class="st">&quot;occurrenceCount&quot;</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;https://species.biodiversitydata.se/ws/search.json?q=odonata&amp;fq=idxtype%3ATAXON&quot;</code></pre>
<pre><code>##       guid                          scientificName    rank occurrenceCount
## 1 10072832  Odonata associated gemycircularvirus 2 species               0
## 2  7367071    Ramalina fastigiata var. odonata Hue variety               0
## 3      789                                 Odonata   order           14121
## 4  8062407 Bdellodes odonata Wallace &amp; Mahon, 1976 species               0
## 5  9829523  Odonata associated gemycircularvirus 1 species               0</code></pre>
<p>We quickly see there that other taxonomic levels appear too, and also
species that look suspiciously as not belonging to dragonflies. But
there is only one order. Let‚Äôs refine the search. To know which search
fields we can use to filter the search we use the function
<code>sbdi_fields(fields_type = "general")</code>. The search field we are looking
for is ‚Äúorder_s.‚Äù</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb72-1" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">search_fulltext</span>(<span class="at">fq =</span> <span class="st">&quot;order_s:Odonata&quot;</span>, <span class="at">page_size =</span> <span class="dv">10</span>)</span>
<span id="cb72-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb72-2" aria-hidden="true" tabindex="-1"></a>sx<span class="sc">$</span>data[, <span class="fu">c</span>(<span class="st">&quot;scientificName&quot;</span>, <span class="st">&quot;rank&quot;</span>, <span class="st">&quot;occurrenceCount&quot;</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;https://species.biodiversitydata.se/ws/search.json?fq=order_s%3AOdonata&amp;fq=idxtype%3ATAXON&amp;pageSize=10&quot;</code></pre>
<pre><code>##        guid                        scientificName    rank occurrenceCount
## 1  11034676      Notoneura xanthe Lieftinck, 1938 species               0
## 2  11034731   Protoneura bifurcata Sj√∂stedt, 1918 species               0
## 3  11034937        Oxygomphus chapini Klots, 1944 species               0
## 4  11035128    Xerolestes pallidus (Rambur, 1842) species               0
## 5  11035335    Mesothemis mithroides Brauer, 1900 species               0
## 6  11029091 Paracercion luzonicum (Asahina, 1968) species               0
## 7  11029136         Onychargia stellata Ris, 1915 species               0
## 8  11029184         Nehalennia sophia Selys, 1840 species               0
## 9  11029206     Lestes lundquisti Lieftinck, 1949 species               0
## 10 11029310                Lestes concinnus Selys species               0</code></pre>
<p>Now we can download the taxonomic data (note that the search is
case-sensitive):</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-1" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> <span class="fu">taxinfo_download</span>(<span class="st">&quot;order_s:Odonata&quot;</span>, </span>
<span id="cb75-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fields =</span> <span class="fu">c</span>(<span class="st">&quot;guid&quot;</span>, <span class="st">&quot;order_s&quot;</span>,<span class="st">&quot;genus_s&quot;</span>, <span class="st">&quot;specificEpithet_s&quot;</span>, </span>
<span id="cb75-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;scientificName&quot;</span>,  <span class="st">&quot;canonicalName_s&quot;</span>, <span class="st">&quot;rank&quot;</span>), </span>
<span id="cb75-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb75-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb75-5" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> tx[tx<span class="sc">$</span>rank <span class="sc">==</span> <span class="st">&quot;species&quot;</span> <span class="sc">&amp;</span> tx<span class="sc">$</span>genusS <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,] <span class="do">## restrict to species and not hybrids</span></span></code></pre></div>
<p>You can save the <code>tx</code> object as the complete species list for later use.</p>
</div>
<div id="filter-the-search-to-get-the-observations" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Filter the search to get the observations</h2>
<p>We start by searching for the data resource we are interested in using
the function <code>pick_filter()</code>. This is an interactive query guiding you
through the many resources available to filtering your query (data
resources, spatial layers, and curated species lists).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># follow the instructions </span></span>
<span id="cb76-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb76-2" aria-hidden="true" tabindex="-1"></a>fq_str <span class="ot">&lt;-</span> <span class="fu">pick_filter</span>(<span class="st">&quot;resource&quot;</span>) </span></code></pre></div>
<p>Follow the instructions. Your choices here would have been ‚Äúin3‚Äù ‚Äì&gt;
‚Äúdr5.‚Äù Your variable <code>fq_str</code> will now contain a string
‚Äúdata_resource_uid:dr5.‚Äù</p>
<p>We only want to look at data from year 2000 to 2010:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-1" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb77-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb77-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-3" aria-hidden="true" tabindex="-1"></a>fq_str <span class="ot">&lt;-</span> <span class="fu">c</span>(fq_str, <span class="fu">paste0</span>(<span class="st">&quot;year:[&quot;</span>, y1, <span class="st">&quot; TO &quot;</span>, y2,<span class="st">&quot;]&quot;</span>))</span>
<span id="cb77-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the square brackets are hard limits</span></span></code></pre></div>
<p>We also want to filter spatially for Southern Sweden
(<a href="https://en.wikipedia.org/wiki/G%C3%B6taland">G√∂taland</a>).</p>
<p>Vector spatial layers (eg. polygons) can be imported in a number of
different ways. SBDI APIs take as search input polygons in the so-called
WKT <a href="https://www.geoapi.org/3.0/javadoc/org/opengis/referencing/doc-files/WKT.html">Well Known
Text</a>
format. So the first step is to load a vector layer and transform it
into a WKT string. You could instead use the data we provid in the
SBDI4R package <code>data("swe")</code>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;swe&quot;</span>,<span class="at">package =</span> <span class="st">&quot;SBDI4R&quot;</span>)</span>
<span id="cb78-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-2" aria-hidden="true" tabindex="-1"></a>wGotaland <span class="ot">&lt;-</span> swe<span class="sc">$</span>Counties<span class="sc">$</span>LnNamn <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Blekinge&quot;</span>, <span class="st">&quot;Gotlands&quot;</span>, <span class="st">&quot;Hallands&quot;</span>, </span>
<span id="cb78-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;J√∂nk√∂pings&quot;</span>, <span class="st">&quot;Kalmar&quot;</span>, <span class="st">&quot;Kronobergs&quot;</span>, </span>
<span id="cb78-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;√ñsterg√∂tlands&quot;</span>, <span class="st">&quot;Sk√•ne&quot;</span>, <span class="st">&quot;V√§stra G√∂talands&quot;</span>)</span>
<span id="cb78-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb78-5" aria-hidden="true" tabindex="-1"></a>gotaland_c <span class="ot">&lt;-</span> swe<span class="sc">$</span>Counties[wGotaland,]</span></code></pre></div>
<p>There are details about this polygon that we need to take care before.
The WKT string should not be too long to be accepted by the API service.
Also, the polygon we just got is projected in the coordinate system
SWEREF99 TM, and the API service only accepts coordinates in a geodesic
coordinate system WGS84. Let‚Äôs construct the WKT string:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform the CRS</span></span>
<span id="cb79-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-2" aria-hidden="true" tabindex="-1"></a>gotaland_c <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(gotaland_c,</span>
<span id="cb79-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb79-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># disolve the counties into one polygon</span></span>
<span id="cb79-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-6" aria-hidden="true" tabindex="-1"></a>gotaland <span class="ot">&lt;-</span> <span class="fu">st_union</span>(gotaland_c)</span>
<span id="cb79-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create a convex hull of the polygon to simplify the geometry and </span></span>
<span id="cb79-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce the length of the WKT string</span></span>
<span id="cb79-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-10" aria-hidden="true" tabindex="-1"></a>gotaland_ch <span class="ot">&lt;-</span> <span class="fu">st_convex_hull</span>(gotaland)</span>
<span id="cb79-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cast it as MULTIPOLYGON as this is what SBDIs API need</span></span>
<span id="cb79-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: as of today, the SBDI APIs will only work properly if the polygon is </span></span>
<span id="cb79-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># submitted as a MULTIPOLYGON</span></span>
<span id="cb79-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-15" aria-hidden="true" tabindex="-1"></a>gotaland_ch <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(gotaland_ch, <span class="at">to =</span> <span class="st">&quot;MULTIPOLYGON&quot;</span>)</span>
<span id="cb79-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create WKT string</span></span>
<span id="cb79-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb79-18" aria-hidden="true" tabindex="-1"></a>wkt <span class="ot">&lt;-</span> <span class="fu">st_as_text</span>(gotaland_ch)</span></code></pre></div>
<p>The WKT string then looks like this:</p>
<pre><code>## [1] &quot;MULTIPOLYGON (((13.33575 55.34003, 12.81633 55.38594, 11.25342 58.35786, 11.13161 58.90942, 11.13145 59.01184, 11.21142 59.0897, 11.31566 59.11651, 11.82032 59.23553, 11.94833 59.26237, 12.06197 59.27159, 12.23104 59.27357, 15.79383 59.03876, 15.84306 59.02498, 19.2889 57.99043, 19.3058 57.96888, 18.90037 57.44014, 18.86704 57.39753, 18.3725 57.00678, 18.30044 56.9528, 16.40805 56.20229, 14.19057 55.38557, 13.33575 55.34003)))&quot;</code></pre>
<p><img src="r-tools-tutorial_files/figure-html/searchpoly-1.png" width="672" /></p>
<p>Next, we download the observations using the command <code>occurrences()</code>,
but be aware that the search fields may not be the same as those used to
search for taxa. We therefore recommend using the function
<code>sbdi_fields("occurrence")</code> to find out which search fields we can use
to filter for occurrences. Here we see that the field we need this time
is ‚Äúorder.‚Äù</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-1" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">occurrences</span>(<span class="at">taxon =</span> <span class="st">&quot;order:Odonata&quot;</span>, </span>
<span id="cb81-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fq =</span> fq_str,</span>
<span id="cb81-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">wkt =</span> wkt,</span>
<span id="cb81-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extra =</span> <span class="st">&quot;collector&quot;</span>,</span>
<span id="cb81-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">email =</span> <span class="st">&quot;sbdi4r-test@biodiversitydata.se&quot;</span>, </span>
<span id="cb81-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb81-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">download_reason_id =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>We have now downloaded the data locally and depending on your
configuration this will be cached on your computer. However, as the
search and download could take long time, we recommend to save the data
locally. appropriate</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(xf, <span class="at">file =</span> <span class="st">&quot;an_appropriate_name.rdata&quot;</span>)</span>
<span id="cb82-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;an_appropriate_name.rdata&quot;</span>)</span></code></pre></div>
</div>
<div id="quality-and-fit-for-use-check" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Quality and fit-for-use check</h2>
<p>Before we can use the observation records we need to know if the
observation effort (sampling effort) has varied over time and in space.
We can approximate observation effort from the data by defining field
visits i.e.¬†occasions at which an observer has sampled observations. We
reconstruct field visits (that is, assign each observation a visitUID)
using using the package <a href="https://greensway.github.io/BIRDS/">BIRDS</a>.
Additionally we want the data to be summarized over a grid of 25 km
(provided through the SBDI4R package). The following functions will
perform many different summaries at the same time. Please refer to the
BIRDS package documentation for more detail.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb83-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;Greensway/BIRDS&quot;</span>)</span></code></pre></div>
<pre><code>## xfun        (0.24   -&gt; 0.26  ) [CRAN]
## digest      (0.6.27 -&gt; 0.6.28) [CRAN]
## stringi     (1.7.4  -&gt; 1.7.5 ) [CRAN]
## mime        (0.11   -&gt; 0.12  ) [CRAN]
## tibble      (3.1.3  -&gt; 3.1.5 ) [CRAN]
## matrixStats (0.59.0 -&gt; 0.61.0) [CRAN]
## e1071       (1.7-7  -&gt; 1.7-9 ) [CRAN]
## robustbase  (0.93-8 -&gt; 0.93-9) [CRAN]
## tidyr       (1.1.3  -&gt; 1.1.4 ) [CRAN]
## rgdal       (1.5-23 -&gt; 1.5-27) [CRAN]
## 
##   There are binary versions available but the source versions are later:
##         binary source needs_compilation
## stringi  1.7.4  1.7.5              TRUE
## tibble   3.1.4  3.1.5              TRUE
## 
## package &#39;xfun&#39; successfully unpacked and MD5 sums checked
## package &#39;digest&#39; successfully unpacked and MD5 sums checked
## package &#39;mime&#39; successfully unpacked and MD5 sums checked
## package &#39;matrixStats&#39; successfully unpacked and MD5 sums checked
## package &#39;e1071&#39; successfully unpacked and MD5 sums checked
## package &#39;robustbase&#39; successfully unpacked and MD5 sums checked
## package &#39;rgdal&#39; successfully unpacked and MD5 sums checked
## 
## The downloaded binary packages are in
##  C:\Users\Alejandro\AppData\Local\Temp\RtmpEfe7wo\downloaded_packages
##   
  
  
   checking for file &#39;C:\Users\Alejandro\AppData\Local\Temp\RtmpEfe7wo\remotes25ec444518d9\Greensway-BIRDS-8a336fd/DESCRIPTION&#39; ...
  
   checking for file &#39;C:\Users\Alejandro\AppData\Local\Temp\RtmpEfe7wo\remotes25ec444518d9\Greensway-BIRDS-8a336fd/DESCRIPTION&#39; ... 
  
v  checking for file &#39;C:\Users\Alejandro\AppData\Local\Temp\RtmpEfe7wo\remotes25ec444518d9\Greensway-BIRDS-8a336fd/DESCRIPTION&#39;
## 
  
  
  
-  preparing &#39;BIRDS&#39;: (1.9s)
##    checking DESCRIPTION meta-information ...
  
   checking DESCRIPTION meta-information ... 
  
v  checking DESCRIPTION meta-information
## 
  
  
  
-  installing the package to process help pages
## 
  
  
  
-  saving partial Rd database (13.6s)
## 
  
  
  
-  checking for LF line-endings in source and make files and shell scripts
## 
  
  
  
-  checking for empty or unneeded directories
## 
  
Removed empty directory 
  
   Removed empty directory &#39;BIRDS/data-raw&#39;
## 
  
  
  
-  building &#39;BIRDS_0.2.2.tar.gz&#39;
## 
  
   
## </code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BIRDS)</span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-1" aria-hidden="true" tabindex="-1"></a>OB <span class="ot">&lt;-</span> <span class="fu">organiseBirds</span>(xf<span class="sc">$</span>data, <span class="at">sppCol =</span> <span class="st">&quot;species&quot;</span> , </span>
<span id="cb86-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-2" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># We only want observations identified at the species level</span></span>
<span id="cb86-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxonRankCol =</span> <span class="st">&quot;rank&quot;</span>, <span class="at">taxonRank =</span> <span class="st">&quot;species&quot;</span>, </span>
<span id="cb86-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># the visits are defined by collector and named locality</span></span>
<span id="cb86-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idCols =</span> <span class="fu">c</span>(<span class="st">&quot;locality&quot;</span>, <span class="st">&quot;collector&quot;</span>), </span>
<span id="cb86-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">timeCols =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>), </span>
<span id="cb86-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xyCols =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;latitude&quot;</span>) )</span>
<span id="cb86-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We don&#39;t need the whole grid, just the piece that overlaps our searching polygon</span></span>
<span id="cb86-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-10" aria-hidden="true" tabindex="-1"></a>wInt <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">st_intersects</span>(gotaland, Sweden_Grid_25km_Wgs84))</span>
<span id="cb86-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-11" aria-hidden="true" tabindex="-1"></a>gotaland_grid25 <span class="ot">&lt;-</span> Sweden_Grid_25km_Wgs84[wInt,]</span>
<span id="cb86-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb86-13" aria-hidden="true" tabindex="-1"></a>SB <span class="ot">&lt;-</span> <span class="fu">summariseBirds</span>(OB, <span class="at">grid =</span> gotaland_grid25, <span class="at">spillOver =</span> <span class="st">&quot;unique&quot;</span>)</span></code></pre></div>
<p>Once summarised, we can see over space and for a few selected years how
the number of observations is distributed:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-1" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(SB<span class="sc">$</span>spatial<span class="sc">$</span>nObs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-2" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb87-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb87-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb87-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-5" aria-hidden="true" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>()</span>
<span id="cb87-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb87-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SB<span class="sc">$</span>spatial<span class="sc">$</span>geometry, <span class="at">col=</span><span class="fu">palBW</span>(SB<span class="sc">$</span>spatial<span class="sc">$</span>nObs),</span>
<span id="cb87-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">main=</span><span class="st">&quot;All years&quot;</span>) <span class="do">## with palette</span></span>
<span id="cb87-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb87-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb87-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb87-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb87-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="do">## or export other combinations, e.g. one map per observed year</span></span>
<span id="cb87-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-15" aria-hidden="true" tabindex="-1"></a>yearlySp <span class="ot">&lt;-</span> <span class="fu">exportBirds</span>(SB, </span>
<span id="cb87-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimension =</span> <span class="st">&quot;spatial&quot;</span>, </span>
<span id="cb87-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">timeRes =</span> <span class="st">&quot;yearly&quot;</span>, </span>
<span id="cb87-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable =</span> <span class="st">&quot;nObs&quot;</span>, </span>
<span id="cb87-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb87-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-21" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(yearlySp<span class="sc">$</span><span class="st">&#39;2005&#39;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-22" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb87-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-23" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb87-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb87-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yearlySp<span class="sc">$</span>geometry, <span class="at">col=</span><span class="fu">palBW</span>(yearlySp<span class="sc">$</span><span class="st">&#39;2005&#39;</span>), </span>
<span id="cb87-27"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,<span class="at">main=</span><span class="st">&quot;2005&quot;</span>)</span>
<span id="cb87-28"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb87-29"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb87-30"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb87-31"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb87-32"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb87-33"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-34"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-34" aria-hidden="true" tabindex="-1"></a>maxC <span class="ot">&lt;-</span> <span class="fu">max</span>(yearlySp<span class="st">&#39;2010&#39;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-35"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-35" aria-hidden="true" tabindex="-1"></a>palBW <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;navyblue&quot;</span>), </span>
<span id="cb87-36"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-36" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="dv">0</span>, maxC), </span>
<span id="cb87-37"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-37" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb87-38"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-39"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yearlySp<span class="sc">$</span>geometry, <span class="at">col=</span><span class="fu">palBW</span>(yearlySp<span class="sc">$</span><span class="st">&#39;2010&#39;</span>), </span>
<span id="cb87-40"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,<span class="at">main=</span><span class="st">&quot;2010&quot;</span>)</span>
<span id="cb87-41"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-41" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb87-42"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb87-43"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">palBW</span>(<span class="fu">seq</span>(<span class="dv">0</span>, maxC, <span class="at">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb87-44"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb87-45"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of </span><span class="sc">\n</span><span class="st">observations&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb87-46"><a href="example-with-opportunistic-data-on-dragonflies.html#cb87-46" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/plotBIRDSspatial-1.png" width="768" /></p>
<p>We now want to use the number of field visits as the measure for
sampling effort. :</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb88-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb88-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb88-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb88-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-6" aria-hidden="true" tabindex="-1"></a>vis <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> SB<span class="sc">$</span>spatial, <span class="fu">aes</span>( <span class="at">fill =</span> nVis)) <span class="sc">+</span></span>
<span id="cb88-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb88-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Visits&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#56B1F7&quot;</span>,</span>
<span id="cb88-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;#132B43&quot;</span>,</span>
<span id="cb88-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb88-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb88-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb88-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-15" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> SB<span class="sc">$</span>spatial, <span class="fu">aes</span>( <span class="at">fill =</span> nSpp)) <span class="sc">+</span></span>
<span id="cb88-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb88-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Number of species&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#56B1F7&quot;</span>,</span>
<span id="cb88-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;#132B43&quot;</span>,</span>
<span id="cb88-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb88-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb88-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb88-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(vis, spp, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/ggplot1-1.png" width="768" /></p>
<div id="temporal-check" class="section level4" number="2.3.0.1">
<h4><span class="header-section-number">2.3.0.1</span> Temporal check</h4>
<p>We see that <code>SB</code> contains an element called <code>SB$temporal</code> that contains
a daily time series with time-specific rows when there is information.
<code>xts</code> also supports day time, but dating below day resolution is not yet
implemented in the <code>BIRDS</code> package.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb89-1" aria-hidden="true" tabindex="-1"></a>sb.xts <span class="ot">&lt;-</span> SB<span class="sc">$</span>temporal</span>
<span id="cb89-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sb.xts, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2000-03-24    1    1    1
## 2000-04-05    4    3    3
## 2000-04-06   11    6    3
## 2000-04-10    1    1    1
## 2000-04-12    3    3    1</code></pre>
<p>Sub-setting is convenient in <code>xts</code> as you can do it with its dates and
with a <code>/</code> for a range of dates.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb91-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09-07&quot;</span>] <span class="co">#a specific day</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-07   19   10   12</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb93-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09-01/2010-09-15&quot;</span>] <span class="co">#for a period</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-01   46   19   14
## 2010-09-02   28   14   12
## 2010-09-03   23   10   10
## 2010-09-04   64   20   18
## 2010-09-05   74   27   12
## 2010-09-06   18    5   11
## 2010-09-07   19   10   12
## 2010-09-08   13    6    8
## 2010-09-09   32   12   14
## 2010-09-10    1    1    1
## 2010-09-11   16    9    8
## 2010-09-12   20   10    8
## 2010-09-13   14    5    9
## 2010-09-14    1    1    1
## 2010-09-15    3    3    2</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb95-1" aria-hidden="true" tabindex="-1"></a>sb.xts[<span class="st">&quot;2010-09&quot;</span>] <span class="co">#a specific month</span></span></code></pre></div>
<pre><code>##            nObs nVis nSpp
## 2010-09-01   46   19   14
## 2010-09-02   28   14   12
## 2010-09-03   23   10   10
## 2010-09-04   64   20   18
## 2010-09-05   74   27   12
## 2010-09-06   18    5   11
## 2010-09-07   19   10   12
## 2010-09-08   13    6    8
## 2010-09-09   32   12   14
## 2010-09-10    1    1    1
## 2010-09-11   16    9    8
## 2010-09-12   20   10    8
## 2010-09-13   14    5    9
## 2010-09-14    1    1    1
## 2010-09-15    3    3    2
## 2010-09-17    3    2    3
## 2010-09-18    9    5    5
## 2010-09-19   12    7    5
## 2010-09-21    3    2    3
## 2010-09-22    4    4    2
## 2010-09-23    3    3    2
## 2010-09-24   10    5    5
## 2010-09-25    7    4    6
## 2010-09-26    7    6    2
## 2010-09-28    2    2    2
## 2010-09-29    5    3    4
## 2010-09-30    2    2    2</code></pre>
<p>The package <code>xts</code> has several tools for converting to different time
periods. Here we use <code>apply.monthly</code> to obtain the total number of
observations and visits per month. The plot command for an object of
calss <code>xts</code> provides a many features. This makes it fairly easy to
customize your plots. Read more in <code>?plot.xts</code>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb97-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-2" aria-hidden="true" tabindex="-1"></a>obs.m <span class="ot">&lt;-</span> <span class="fu">apply.monthly</span>(sb.xts<span class="sc">$</span>nObs, <span class="st">&quot;sum&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-3" aria-hidden="true" tabindex="-1"></a>vis.m <span class="ot">&lt;-</span> <span class="fu">apply.monthly</span>(sb.xts<span class="sc">$</span>nVis, <span class="st">&quot;sum&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(obs.m, </span>
<span id="cb97-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>, </span>
<span id="cb97-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">grid.ticks.on =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb97-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">major.ticks =</span> <span class="st">&quot;year&quot;</span>, </span>
<span id="cb97-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">grid.col =</span> <span class="st">&quot;lightgrey&quot;</span>,  </span>
<span id="cb97-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Total number of daily observations and visits per month&quot;</span>)</span>
<span id="cb97-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(vis.m, <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">on =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/unnamed-chunk-15-1.png" width="768" /></p>
</div>
</div>
<div id="species-trends" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Species trends</h2>
<p>We can now look at some particular species and ask whether those have
changed in occurrence over time:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">speciesSummary</span>(SB)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>##                       species nCells nObs nVis
## 1              Aeshna affinis      3   32   27
## 2             Aeshna caerulea      6   13   13
## 3               Aeshna cyanea    128  896  861
## 4              Aeshna grandis    156 1765 1735
## 5             Aeshna isoceles     25  172  169
## 6               Aeshna juncea    101  366  353
## 7                Aeshna mixta     81  677  646
## 8              Aeshna serrata     13   39   38
## 9           Aeshna subarctica     35  108   99
## 10             Aeshna viridis     13   40   35
## 11             Anax imperator     51  559  515
## 12            Anax parthenope      2    5    5
## 13        Brachytron pratense     93  505  492
## 14       Calopteryx splendens    102  682  628
## 15           Calopteryx virgo    124 1061 1007
## 16         Coenagrion armatum     23   74   67
## 17      Coenagrion hastulatum    118  941  908
## 18      Coenagrion johanssoni     15   75   70
## 19       Coenagrion lunulatum     42  111  104
## 20          Coenagrion puella    124 1415 1360
## 21      Coenagrion pulchellum    124 1439 1392
## 22     Cordulegaster boltonii     75  500  493
## 23             Cordulia aenea    122 1072 1053
## 24      Enallagma cyathigerum    149 1717 1630
## 25        Epitheca bimaculata     16   36   35
## 26           Erythromma najas     97  774  741
## 27       Erythromma viridulum     13  143  126
## 28      Gomphus vulgatissimus     48  160  155
## 29           Ischnura elegans    124 1351 1294
## 30           Ischnura pumilio     22  110   95
## 31               Lestes dryas     52  214  206
## 32              Lestes sponsa    147 1454 1385
## 33              Lestes virens     50  201  188
## 34     Leucorrhinia albifrons     47  185  180
## 35      Leucorrhinia caudalis     34  143  136
## 36         Leucorrhinia dubia     85  338  320
## 37    Leucorrhinia pectoralis     85  368  351
## 38     Leucorrhinia rubicunda     96  445  432
## 39         Libellula depressa    110  569  546
## 40            Libellula fulva      9  101   90
## 41   Libellula quadrimaculata    160 2096 2047
## 42        Nehalennia speciosa      3   34   33
## 43   Onychogomphus forcipatus     76  447  445
## 44      Orthetrum cancellatum    129 1079 1025
## 45     Orthetrum coerulescens     76  253  246
## 46       Platycnemis pennipes     92  545  529
## 47        Pyrrhosoma nymphula    127  974  945
## 48       Somatochlora arctica     28   45   42
## 49 Somatochlora flavomaculata     90  427  420
## 50     Somatochlora metallica    109  621  612
## 51             Sympecma fusca     50  269  264
## 52          Sympecma paedisca      2    5    5
## 53            Sympetrum danae    136  803  768
## 54        Sympetrum flaveolum     82  302  295
## 55     Sympetrum fonscolombii      2    2    2
## 56       Sympetrum sanguineum    137 1268 1224
## 57       Sympetrum striolatum     84  311  298
## 58         Sympetrum vulgatum    128 1072 1016</code></pre>
<p>We pick two species and compare their trends in number of visits where
the species where reported, relative to the total number of visits.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb100-2"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-2" aria-hidden="true" tabindex="-1"></a>sppCount <span class="ot">&lt;-</span> <span class="fu">obsData</span>(OB) <span class="sc">|&gt;</span> </span>
<span id="cb100-3"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year, visitUID) <span class="sc">|&gt;</span> </span>
<span id="cb100-4"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="st">&quot;focalCountLq&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(scientificName <span class="sc">==</span> <span class="st">&quot;Libellula quadrimaculata&quot;</span>),</span>
<span id="cb100-5"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;focalCountSd&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(scientificName <span class="sc">==</span> <span class="st">&quot;Sympetrum sanguineum&quot;</span>),</span>
<span id="cb100-6"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;sppLength&quot;</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(scientificName)), </span>
<span id="cb100-7"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb100-8"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb100-9"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span> </span>
<span id="cb100-10"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="st">&quot;focalCountLq&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(focalCountLq),</span>
<span id="cb100-11"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;focalCountSd&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(focalCountSd),</span>
<span id="cb100-12"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;nVis&quot;</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(visitUID)),</span>
<span id="cb100-13"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;relCountLq&quot;</span> <span class="ot">=</span> focalCountLq <span class="sc">/</span> nVis,</span>
<span id="cb100-14"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;relCountSd&quot;</span> <span class="ot">=</span> focalCountSd <span class="sc">/</span> nVis,</span>
<span id="cb100-15"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="cn">NULL</span>)</span>
<span id="cb100-16"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-17" aria-hidden="true" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-18"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sppCount<span class="sc">$</span>year, sppCount<span class="sc">$</span>relCountLq, </span>
<span id="cb100-19"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, </span>
<span id="cb100-20"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Relative number of visits with observations&quot;</span>, </span>
<span id="cb100-21"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(sppCount<span class="sc">$</span>relCountLq)), </span>
<span id="cb100-22"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxp=</span><span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2010</span>, <span class="dv">10</span>))</span>
<span id="cb100-23"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sppCount<span class="sc">$</span>year, sppCount<span class="sc">$</span>relCountSd, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;#78D2EB&quot;</span>)</span>
<span id="cb100-24"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="cb100-25"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Libellula quadrimaculata&quot;</span>,<span class="st">&quot;Sympetrum sanguineum&quot;</span>), </span>
<span id="cb100-26"><a href="example-with-opportunistic-data-on-dragonflies.html#cb100-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">text.font =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#78D2EB&quot;</span>), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="r-tools-tutorial_files/figure-html/trends-1.png" width="768" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="example-with-opportunistic-data-on-dragonflies.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="example-with-fish-data-from-sers.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-tools-tutorial.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "chapter"
}
});
});
</script>

</body>

</html>
