[["example-with-opportunistic-data-on-dragonflies.html", "2 Example with opportunistic data on Dragonflies 2.1 Name searching 2.2 Get the observations, filter the search, get quality assertions, plotting data on a map and save data", " 2 Example with opportunistic data on Dragonflies In this example we are interested in exploring opportunistically collected data from the Swedish citizen science observation data portal - Artportalen. 2.1 Name searching To begin, we want be sure there is an unequivocal way to find the species within the order Odonata and nothing else, so lets search for it: sx &lt;- search_fulltext(&quot;odonata&quot;) sx$data[, c(&quot;guid&quot;, &quot;scientificName&quot;, &quot;rank&quot;, &quot;occurrenceCount&quot;)] ## guid scientificName rank occurrenceCount ## 1 9829523 Odonata associated gemycircularvirus 1 species 0 ## 2 10072832 Odonata associated gemycircularvirus 2 species 0 ## 3 8062407 Bdellodes odonata Wallace &amp; Mahon, 1976 species 0 ## 4 789 Odonata order 207680 ## 5 7367071 Ramalina fastigiata var. odonata Hue variety 0 We quickly see there that other taxonomic definitions appear too, but there is only one order. Lets refine the search. To know which search fields we can use to filter the search we use the function sbdi_fields(fields_type = \"general\"). The search field we are looking for is order_s. sx &lt;- search_fulltext(fq=&quot;order_s:Odonata&quot;, page_size = 10) ## [1] &quot;https://species.biodiversitydata.se/ws/search.json?fq=order_s%3AOdonata&amp;fq=idxtype%3ATAXON&amp;pageSize=10&quot; sx$data[, c(&quot;scientificName&quot;, &quot;rank&quot;, &quot;occurrenceCount&quot;)] ## scientificName rank occurrenceCount ## 1 Gomphomacromia Brauer, 1864 genus 1 ## 2 Austropetalia Tillyard, 1916 genus 0 ## 3 Sogjutella Pritykina, 1980 genus 0 ## 4 Neuragrion Karsch, 1891 genus 0 ## 5 Xamenophlebia Pritykina, 1981 genus 0 ## 6 Lauromacromia Geijskes, 1970 genus 0 ## 7 Sympetrum Newman, 1833 genus 27050 ## 8 Corduliochlora Marinov &amp; Seidenbusch, 2007 genus 0 ## 9 Torrenticnemis Lieftinck, 1949 genus 0 ## 10 Cyanallagma Kennedy, 1920 genus 0 Now we can download the taxonomic data (note that the search is case-sensitive): tx &lt;- taxinfo_download(&quot;order_s:Odonata&quot;, fields = c(&quot;guid&quot;, &quot;order_s&quot;,&quot;genus_s&quot;, &quot;specificEpithet_s&quot;, &quot;scientificName&quot;, &quot;canonicalName_s&quot;, &quot;rank&quot;), verbose = FALSE) tx &lt;- tx[tx$rank == &quot;species&quot; &amp; tx$genusS != &quot;&quot;,] ## restrict to species and not hybrids Then you can save tx as the complete species list for later use. 2.2 Get the observations, filter the search, get quality assertions, plotting data on a map and save data As usual we start by searching for the data resource we are interested in using the function pick_filter(). This is an interactive query guiding you through the many resources available to filtering your query (data resources, spatial layers, and curated species lists). # follow the instructions fq_str &lt;- pick_filter(&quot;resource&quot;) Follow the instruction. Your choices here would have been in3 &gt; dr5. Your variable fq_str will now contain a string data_resource_uid:dr5. We only need data from 2000 to 2010 y1 &lt;- 2000 y2 &lt;- 2010 fq_str &lt;- c(fq_str, paste0(&quot;year:[&quot;, y1, &quot; TO &quot;, y2,&quot;]&quot;)) # Note the square brackets are hard limits Select data  get records for Southern Sweden (Götaland). Vector spatial layers (eg. polygons) can be imported in a number of different ways. SBDI APIs take as search input polygons in the s.k. WKT Well Known Text format. So the first step is to load a vector layer and transform it into a WKT string. You could instead use the data we kindly provided in the SBDI4R package data(\"swe\"). data(&quot;swe&quot;) wGotaland &lt;- swe$Counties$LnNamn %in% c(&quot;Blekinge&quot;, &quot;Gotlands&quot;, &quot;Hallands&quot;, &quot;Jönköpings&quot;, &quot;Kalmar&quot;, &quot;Kronobergs&quot;, &quot;Östergötlands&quot;, &quot;Skåne&quot;, &quot;Västra Götalands&quot;) shape &lt;- swe$Counties[wGotaland,] We could create the WKT string using the rgeos library: library(rgeos) wkt &lt;- writeWKT(shape) Unfortunately, in this instance this gives a WKT string that is too long and wont be accepted by the web service. Also, the shapefile we just got is projected in the coordinate system SWEREF99 TM, and the web service only accepts coordinates in a geodesic coordinate system WGS84. Instead, lets construct the WKT string directly, which gives us a little more control over its format: shape &lt;- sf::as_Spatial( sf::st_transform( sf::st_as_sf(shape), crs = sf::st_crs(4326)$wkt) ) # extract the polygon coordinates lonlat &lt;- shape@polygons[[1]]@Polygons[[1]]@coords # create a convex hull of the polygon to reduce the length of the WKT string chull_temp &lt;- chull(lonlat) lonlat &lt;- lonlat[c(chull_temp, chull_temp[1]), ] # create WKT string # first join each lon-lat coordinate pair wkt_temp &lt;- apply(lonlat, 1, function(z) paste(round(z,4), collapse=&quot; &quot;)) # now build the WKT string wkt &lt;- paste(&quot;MULTIPOLYGON(((&quot;, paste(wkt_temp, collapse=&quot;,&quot;), &quot;)))&quot;, sep=&quot;&quot;) # NOTE: as of today, the SBDI APIs will only work properly if the polygon is # submitted as a MULTIPOLYGON wkt=wkt, but before we can use the observation records we need to know how the observation effort has varied over time and in space. For this we define field visits i.e. occasions at which an observer has sampled observations  if we have information on observer id, location id and date we can aggregate data into field visits. We do this using BIRDS, and 25km grid: How has observation effort (frequency of visits) varied over time and space?  1) show maps as in Example 7 (all years, year 2000, 2002, 2004, 2006, 2008, 2010), 2 make also a time line plot with no. visits against years, no. of gridcells with visits against years. We can now look at some particular species and ask whether this has changed in occurrence over time: Plot no. records of species x and no. visits all species over years (we simply explore by comparing records for a species with no visits, can assume that species has increased of stronger positive trend than for no. visits) Plot no. gridcells with visits for species x and no. gridcells with visits for all species over years (we simply explore by comparing records for a species with no visits, can assume that species has increased of stronger positive trend than for no. visits) (species x: Tvåfläckad trollslända Epitheca bimaculata) "]]
